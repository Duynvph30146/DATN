<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<!--thư viện-->
<nav th:replace="~{/layout/head.html}"></nav>
<!--Các sản phẩm nổi bật-->
<style>
    /* Dùng thanh cuộn ngang */
    .tab-pane.horizontal-scrollable .single-products.row {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: hidden; /* Ẩn thanh cuộn ngang */
        -webkit-overflow-scrolling: touch; /* Cho thanh cuộn ngang trên iOS */
    }

    .tab-pane.horizontal-scrollable .col-md-3 {
        flex: 0 0 auto;
        width: 25%; /* Hiển thị 4 cột trên mỗi hàng */
    }

    .tab-pane.horizontal-scrollable {
        position: relative; /* Đặt vị trí tương đối để các nút cuộn được định vị dựa trên phần tử cha */
    }

    .scroll-prev, .scroll-next {
        position: absolute; /* Đặt vị trí tuyệt đối để căn chỉnh chính xác */
        top: 30%; /* Đặt vị trí theo chiều dọc giữa của phần tử cha */
        transform: translateY(-50%); /* Dịch chuyển các nút lên hoặc xuống để căn chỉnh theo chiều dọc */
        z-index: 10; /* Đảm bảo nút nằm trên các phần tử khác */
    }

    .scroll-prev {
        left: 0; /* Đặt vị trí của nút cuộn về trước */
    }

    .scroll-next {
        right: 0; /* Đặt vị trí của nút cuộn về sau */
    }

</style>
<!--Các sản phẩm mới nhất-->
<style>
    /* Dùng thanh cuộn ngang cho sản phẩm mới nhất */
    .tab-pane.horizontal-scrollable-new .single-products-new.row {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: hidden; /* Ẩn thanh cuộn ngang */
        -webkit-overflow-scrolling: touch; /* Cho thanh cuộn ngang trên iOS */
    }

    .tab-pane.horizontal-scrollable-new .col-md-3 {
        flex: 0 0 auto;
        width: 25%; /* Hiển thị 4 cột trên mỗi hàng */
    }

    .tab-pane.horizontal-scrollable-new {
        position: relative; /* Đặt vị trí tương đối để các nút cuộn được định vị dựa trên phần tử cha */
    }

    .scroll-prev-new, .scroll-next-new {
        position: absolute; /* Đặt vị trí tuyệt đối để căn chỉnh chính xác */
        top: 30%; /* Đặt vị trí theo chiều dọc giữa của phần tử cha */
        transform: translateY(-50%); /* Dịch chuyển các nút lên hoặc xuống để căn chỉnh theo chiều dọc */
        z-index: 10; /* Đảm bảo nút nằm trên các phần tử khác */
    }

    .scroll-prev-new {
        left: 0; /* Đặt vị trí của nút cuộn về trước */
    }

    .scroll-next-new {
        right: 0; /* Đặt vị trí của nút cuộn về sau */
    }

</style>

<style>
    #carouselExample .carousel-indicators img {
        width: 200px;
        height: 50px;
        object-fit: cover;
    }

</style>

<style>
    .row {
        display: flex; /* Sử dụng flexbox để căn giữa các phần tử con */
        justify-content: center; /* Căn giữa theo chiều ngang */
    }

    .column {
        /*margin: 0 auto; !* Tự động căn giữa theo chiều ngang *!*/
        text-align: center; /* Căn giữa nội dung của ảnh */
    }

    * {
        box-sizing: border-box;
    }

    /* Position the image container (needed to position the left and right arrows) */
    .container {
        position: relative;
    }

    /* Hide the images by default */
    .mySlides {
        display: none;
    }

    /* Add a pointer when hovering over the thumbnail images */
    .cursor {
        cursor: pointer;
    }

    .mySlides {
        position: relative; /* Đặt phần tử cha là relative */
    }

    .prev, .next {
        position: absolute; /* Đặt vị trí tuyệt đối */
        top: 50%; /* Đặt top ở giữa */
        transform: translateY(-50%); /* Dịch chuyển lên trên 50% của phần tử cha */
        width: auto;
        padding: 16px;
        color: white;
        font-weight: bold;
        font-size: 20px;
        border-radius: 0 3px 3px 0;
        user-select: none;
        -webkit-user-select: none;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .prev {
        left: 0; /* Đặt nút prev ở bên trái */
    }

    .next {
        right: 0; /* Đặt nút next ở bên phải */
    }


    /* On hover, add a black background color with a little bit see-through */
    .prev:hover,
    .next:hover {
        background-color: rgba(0, 0, 0, 0.8);
    }

    /* Number text (1/3 etc) */
    .numbertext {
        color: #f2f2f2;
        font-size: 12px;
        padding: 8px 12px;
        position: absolute;
        top: 0;
    }

    /* Container for image text */
    .caption-container {
        text-align: center;
        background-color: #222;
        padding: 2px 16px;
        color: white;
    }

    .row:after {
        content: "";
        display: table;
        clear: both;
    }

    /* Six columns side by side */
    .column {
        float: left;
        width: 16.66%;
    }

    /* Add a transparency effect for thumbnail images */
    .demo {
        opacity: 0.6;
    }

    .active,
    .demo:hover {
        opacity: 1;
    }

</style>
<!--end-->
<body>
<!-- header section start -->
<nav th:replace="~{/layout/header.html}"></nav>
<!-- header section end -->

<!-- product details area start -->
<section class="product-content section-padding">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="left">
                    <!-- Full-width images with number text -->
                    <div th:each="image, index : ${danhSachAnh}" class="mySlides">
                        <div class="numbertext" th:text="${index.index + 1} + ' / ' + ${danhSachAnh.size()}"></div>
                        <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                        <img th:src="@{'/upload/' + ${image.substring(image.lastIndexOf('upload') + 6)}}" style="width:100%" alt="Ảnh">
                        <a class="next" onclick="plusSlides(1)">&#10095;</a>
                    </div>
                    <!-- Next and previous buttons -->
                    <!-- Image text -->
                    <div class="caption-container">
                        <p id="caption"></p>
                    </div>
                    <!-- Thumbnail images -->
                    <p>
                    <div class="row">
                        <div th:each="image, index : ${danhSachAnh}" class="column">
                            <img class="demo cursor" th:src="@{'/upload/' + ${image.substring(image.lastIndexOf('upload') + 6)}}" style="width:100%" onclick="currentSlide(${index.index + 1})" alt="Ảnh">
                        </div>
                    </div>
                    </p>
                </div>
            </div>

            <div class="col-md-6">
                <div class="right">
                    <div class="singl-pro-title">
                        <h3 th:text="${sanpham.tensanpham}"></h3>
                        <h6 th:text="${thuonghieu}"></h6>
                        <h6 th:text="${chatlieu}"></h6>
                        <h6>Tình trạng: Không có hàng</h6>
                        <div th:id="'product-details-' + ${sanpham.id}" th:data-color="${defaultColor}">
                            <!-- Các phần tử khác -->
                            <div class="d-flex">
                                <div th:each="color : ${colors}">
                                    <div style="margin-right: 10px">
                                        <a class="btn btn-outline-dark" th:text="${color}" th:onclick="'updateImagesAndPrice(this, \'' + ${defaultColor} + '\')'"></a>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="d-flex">
                            <div th:each="size : ${sizes}">
                                <div style="margin-right: 10px">
                                    <a class="btn btn-outline-dark" th:text="${size}" onclick="updatePrice('${size}')"></a>
                                </div>
                            </div>
                        </div>

                        <br>
                        <button class="btn btn" style="background-color: rgb(249,72,42);color: white;width: 370px">Thêm vào giỏ hàng</button>
                        <br>
                        <br>
                        <button class="btn btn-dark" style="width: 370px">Mua ngay</button>
                    </div>

                </div>
            </div>
            <h3 style="margin-top: 30px; color: rgb(249, 72, 42); font-family: 'Lucida Sans Typewriter'"
                class="text-center">CÁC SẢN PHẨM LIÊN QUAN</h3>
            <hr class="border border-danger border opacity-50">
            <div class="tab-content">
                <!--nội dung-->
                <div class="tab-pane fade text-center active show horizontal-scrollable" id="gird">
                    <button class="scroll-prev btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                             class="bi bi-chevron-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"/>
                        </svg>
                    </button> <!-- Nút cuộn về trước -->
                    <div class="single-products row">
                        <div class="col-md-3" th:each="sp, stt : ${page}">
                            <div class="product-item margin40">
                                <div class="pro-img">
                                    <a th:href="@{/detailsanphamCustomer/{id}(id=${sp[0]})}">
                                        <img th:if="${sp[6] != null}"
                                             th:src="@{'/upload/' + ${sp[6].substring(sp[6].lastIndexOf('upload') + 6)}}"
                                             class="d-block w-100 carousel-img rounded-3" alt="Ảnh">
                                    </a>
                                    <div class="tag-n-s">
                                        <span>New</span>
                                    </div>
                                    <div class="actions-btn">
                                        <ul class="clearfix">
                                            <li>
                                                <a href="cart.html"><i class="fa fa-shopping-cart"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="fa fa-heart"></i></a>
                                            </li>
                                            <li>
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#quick-view"><i
                                                        class="fa fa-eye"></i></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="product-title">
                                    <a href="#"><h3 class="title" th:text="${sp[1]}"></h3></a>
                                    <div class="ratting">
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star gray-star"></i>
                                    </div>
                                    <p>
                                    <span style="color: red; font-weight: bold"
                                          th:text="${#numbers.formatDecimal(sp[5], 0, 'COMMA', 0, 'POINT') + '&#x20ab;'}"></span>
                                        <!-- <del>$170.00</del> -->
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!---end-->
                    </div>
                    <button class="scroll-next btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                             class="bi bi-chevron-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/>
                        </svg>
                    </button> <!-- Nút cuộn về sau -->
                </div>
                <!--end-->
            </div>

            <!--Các sản phẩm mới nhất-->
            <h3 style="margin-top: 30px; color: rgb(249, 72, 42); font-family: 'Lucida Sans Typewriter'"
                class="text-center">CÁC SẢN PHẨM MỚI NHẤT</h3>
            <hr class="border border-danger border opacity-50">
            <div class="tab-content">
                <!--nội dung-->
                <div class="tab-pane fade text-center active show horizontal-scrollable-new" id="new-products">
                    <button class="scroll-prev-new btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                             class="bi bi-chevron-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"/>
                        </svg>
                    </button> <!-- Nút cuộn về trước -->
                    <div class="single-products-new row">
                        <div class="col-md-3" th:each="sp, stt : ${page2}">
                            <div class="product-item margin40">
                                <div class="pro-img">
                                    <a th:href="@{/detailsanphamCustomer/{id}(id=${sp[0]})}">
                                        <img th:if="${sp[6] != null}"
                                             th:src="@{'/upload/' + ${sp[6].substring(sp[6].lastIndexOf('upload') + 6)}}"
                                             class="d-block w-100 carousel-img rounded-3" alt="Ảnh">
                                    </a>
                                    <div class="tag-n-s">
                                        <span>New</span>
                                    </div>
                                    <div class="actions-btn">
                                        <ul class="clearfix">
                                            <li>
                                                <a href="cart.html"><i class="fa fa-shopping-cart"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="fa fa-heart"></i></a>
                                            </li>
                                            <li>
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#quick-view"><i
                                                        class="fa fa-eye"></i></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="product-title">
                                    <a href="#"><h3 class="title" th:text="${sp[1]}"></h3></a>
                                    <div class="ratting">
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star gray-star"></i>
                                    </div>
                                    <p>
                                    <span style="color: red; font-weight: bold"
                                          th:text="${#numbers.formatDecimal(sp[5], 0, 'COMMA', 0, 'POINT') + '&#x20ab;'}"></span>
                                        <!-- <del>$170.00</del> -->
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!---end-->
                    </div>
                    <button class="scroll-next-new btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                             class="bi bi-chevron-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/>
                        </svg>
                    </button> <!-- Nút cuộn về sau -->
                </div>
                <!--end-->
            </div>
            <!--end-->
        </div>
    </div>
</section>
<!-- product details area end -->

<!-- related product section start -->
<!-- related product section end -->

<!-- footer section start -->
<nav th:replace="~{/layout/footer.html}"></nav>
<!-- footer section end -->

</body>
</html>

<!--scroll-->
<script>
    let slideIndex = 1;
    showSlides(slideIndex);

    // Next/previous controls
    function plusSlides(n) {
        showSlides(slideIndex += n);
    }

    // Thumbnail image controls
    function currentSlide(n) {
        showSlides(slideIndex = n);
    }

    function currentSlide2(n) {
        showSlides(slideIndex = n);
    }

    function showSlides(n) {
        let i;
        let slides = document.getElementsByClassName("mySlides");
        let dots = document.getElementsByClassName("demo");
        let captionText = document.getElementById("caption");
        if (n > slides.length) {
            slideIndex = 1
        }
        if (n < 1) {
            slideIndex = slides.length
        }
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(" active", "");
        }
        slides[slideIndex - 1].style.display = "block";
        dots[slideIndex - 1].className += " active";
        captionText.innerHTML = dots[slideIndex - 1].alt;
    }

    // Add event listeners to thumbnail images
    let thumbnails = document.getElementsByClassName("demo");
    for (let i = 0; i < thumbnails.length; i++) {
        thumbnails[i].addEventListener("click", function () {
            currentSlide(i + 1);
        });
    }
</script>

<!-- các sản phẩm nổi bật-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const scrollableContainer = document.querySelector(".tab-pane.horizontal-scrollable .single-products.row");
        const scrollPrevBtn = document.querySelector(".scroll-prev");
        const scrollNextBtn = document.querySelector(".scroll-next");

        scrollPrevBtn.addEventListener("click", function () {
            if (scrollableContainer.scrollLeft === 0) {
                scrollableContainer.scrollLeft = scrollableContainer.scrollWidth - scrollableContainer.clientWidth;
            } else {
                scrollableContainer.scrollBy({left: -200, behavior: "smooth"});
            }
        });

        scrollNextBtn.addEventListener("click", function () {
            if (scrollableContainer.scrollLeft >= (scrollableContainer.scrollWidth - scrollableContainer.clientWidth)) {
                scrollableContainer.scrollLeft = 0;
            } else {
                scrollableContainer.scrollBy({left: 200, behavior: "smooth"});
            }
        });
    });

</script>

<!-- các sản phẩm mới nhất-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const scrollableContainerNew = document.querySelector(".tab-pane.horizontal-scrollable-new .single-products-new.row");
        const scrollPrevBtnNew = document.querySelector(".scroll-prev-new");
        const scrollNextBtnNew = document.querySelector(".scroll-next-new");

        scrollPrevBtnNew.addEventListener("click", function () {
            if (scrollableContainerNew.scrollLeft === 0) {
                scrollableContainerNew.scrollLeft = scrollableContainerNew.scrollWidth - scrollableContainerNew.clientWidth;
            } else {
                scrollableContainerNew.scrollBy({left: -200, behavior: "smooth"});
            }
        });

        scrollNextBtnNew.addEventListener("click", function () {
            if (scrollableContainerNew.scrollLeft >= (scrollableContainerNew.scrollWidth - scrollableContainerNew.clientWidth)) {
                scrollableContainerNew.scrollLeft = 0;
            } else {
                scrollableContainerNew.scrollBy({left: 200, behavior: "smooth"});
            }
        });
    });

</script>


<script>
    function updateImagesAndPrice(element, defaultColor) {
        const sanPhamId = element.closest('[th\\:id^="product-details-"]').getAttribute('id');
        const color = element.textContent.trim();
        const encodedColor = encodeURIComponent(color);

        fetch(`/api/sanpham/${sanPhamId}/details?color=${encodedColor}`)
            .then(response => response.json())
            .then(data => {
                if (data) {
                    // Cập nhật ảnh
                    const imageContainer = document.querySelector('.left .row');
                    imageContainer.innerHTML = '';
                    data.anh.forEach((image, index) => {
                        imageContainer.innerHTML += `
                        <div class="column">
                            <img class="demo cursor" src="/upload/${image}" style="width:100%" onclick="currentSlide(${index + 1})" alt="Ảnh">
                        </div>`;
                    });

                    // Cập nhật giá
                    document.querySelector('.right .price').innerText = `Giá: ${data.gia} VND`;

                    // Thay đổi màu của nút màu sắc được nhấn
                    const buttons = document.querySelectorAll('.btn.btn-outline-dark');
                    buttons.forEach(btn => {
                        btn.style.borderColor = '';
                        btn.style.color = '';
                    });
                    element.style.borderColor = color;
                    element.style.color = color;
                }
            })
            .catch(error => console.error('Error fetching product details:', error));
    }
</script>
