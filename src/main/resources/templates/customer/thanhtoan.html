<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<!--thư viện-->
<nav th:replace="~{/layout/head.html}"></nav>
<!--<nav th:replace="~{/layoutadmin/head.html}"></nav>-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!--<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>-->
<!--end-->
<style>
    .tong{
        width: 100%;
        background: #fff;
        display: flex;
    }
    .left {
        width: 60%;
        padding-right: 25px;
        border-right: 1px solid #ccc;
        padding-top: 70px;
    }
    .right {
        position: relative;
        padding-top: 45px;
        padding-left: 25px;
        width: 40%;
    }
    .spacer-row {
        height: 15px; /* Chiều cao của hàng trống */
    }
    .xemthem {
        font-size: 14px;
        font-family: 'futura-REGULAR', sans-serif;
        cursor: pointer;
        color: #338dbc;
        fill: none;
        margin-bottom: 15px;
    }
    .qaz {
        padding: 10px 10px; /* Thay đổi padding để đảm bảo không tràn */
        overflow: hidden;
        position: relative;
        margin-bottom: 5px;
        cursor: pointer;
        margin-left: 0;
        display: inline-block; /* Đảm bảo các phần tử hiển thị inline */
    }
    .qaz>span::before {
        content: "";
        display: block;
        width: 15px;
        height: 15px;
        background: #fff;
        border-right: 1px solid red;
        z-index: 1;
        left: 1px; /* Căn chỉnh chính xác bên trái */
        top: 50%;
        position: absolute;
        border-radius: 50%;
        transform: translateY(-50%);
    }
    .qaz::after {
        content: "";
        display: block;
        width: 15px;
        height: 15px;
        background: #fff;
        border-left: 1px solid red;
        z-index: 1;
        right: 1px; /* Căn chỉnh chính xác bên phải */
        top: 50%;
        position: absolute;
        border-radius: 50%;
        transform: translateY(-50%);
    }
    .qaz span {
        border: 1px solid red;
        color: #000;
        padding: 5px 10px;
        border-radius: 3px;
        background: #fff;
        font-weight: 700;
    }
    .ma_giam_gia{
        width: 100%;
        margin-bottom: 15px;
        padding: 5px 10px;
        background: #fff;
        display: flex;
        border-radius: 15px;
    }
    .ma-item-left {
        width: 30%;
        padding-right: 10px;
        display: flex;
        align-items: center;
        border-right: 1px dashed #ccc;
    }
    .anh_ma {
        width: auto;
        height: auto;
        max-width: 100%;
    }
    .ma-item-right {
        padding-left: 10px;
        position: relative;
        width: 70%;
    }
    .ma-item-des {
        display: flex;
        justify-content: space-between;
        align-items: self-end;
        font-size: 10px;
    }
    .code {
        background: yellow;
        color: red;
        font-weight: bolder;
    }
    .right_magiam {
        font-weight: 700;
        padding: 5px 7px;
        background: rgb(249,72,42);
        color: white;
        border-radius: 15px;
        cursor: pointer;
        margin-bottom: 26px;
    }
    .opcion-radio input[type=radio] + label:before {
        content: '';
        background: #F4F5F8;
        border-radius: 100%;
        border: 1px solid #a6aec6;
        display: inline-block;
        width: 1.4em;
        height: 1.4em;
        position: relative;
        top: -.2em;
        margin-right: .5em;
        vertical-align: top;
        cursor: pointer;
        text-align: center;
        -webkit-transition: all 250ms ease;
        transition: all 250ms ease;
        display: inline-block;
        vertical-align: middle;
    }
    .opcion-radio input[type=radio]:checked + label:before {
        background-color: #8879FF;
        box-shadow: inset 0 0 0 4px #F4F5F8;
    }
    .opcion-radio label {
        display: inline-block;
        vertical-align: middle;
        line-height: 32px;
    }
    .icon-clear {
        word-wrap: break-word;
        word-break: break-word;
        border-collapse: collapse;
        border-spacing: 0;
        color: inherit;
        font: inherit;
        margin: 0;
        padding: 0;
        -webkit-font-smoothing: inherit;
        border: none;
        background: transparent;
        line-height: normal;
        -webkit-appearance: button;
        cursor: pointer;
        background-position: center center;
        background-repeat: no-repeat;
        /*display: inline-block;*/
        vertical-align: middle;
        margin-left: 0.28571em;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMiAtNCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAyIC00IDE2IDE2Ij48cGF0aCBvcGFjaXR5PSIuMiIgZD0iTTEwLTRjLTQuNCAwLTggMy42LTggOHMzLjYgOCA4IDggOC0zLjYgOC04LTMuNi04LTgtOHptMy43IDEwLjdsLTEgMS0yLjctMi42LTIuNyAyLjYtMS0xIDIuNi0yLjctMi42LTIuNyAxLTEgMi43IDIuNiAyLjctMi42IDEgMS0yLjYgMi43IDIuNiAyLjd6Ii8+PC9zdmc+'),none;

    }
    </style>
<body>
<!--&lt;!&ndash; header section start &ndash;&gt;-->
<nav th:replace="~{/layout/header.html}"></nav>
<!--&lt;!&ndash; header section end &ndash;&gt;-->
<input type="hidden" th:value="${token}" id="kiemtratokendangnhap">
<div class="tong mt-3 mb-3 container">
    <div class="left">
        <div id="left1" class="left1">
            <img class="logo" src="../dist/img/logo_bong2.jpg" height="70" width="130">
            <p style="color: red; margin: 0;padding: 0;">Mang đến sự tự tin trong bạn</p>
            <h6 style="margin-top: 50px;">THÔNG TIN GIAO HÀNG</h6>
            <div class="mt-3 d-flex justify-content-start">
<!--                <p>Bạn đã có tài khoản?</p>-->
<!--                <a href="#" style="color: rgb(249,72,42); padding-left: 5px; text-decoration: none; text-transform: none;">Đăng nhập</a>-->
            </div>
            <form id="formDiaChiKhachLe" onsubmit="return validateFormDiaChiKhachLe(event)">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="hovaten" placeholder="Họ và tên">
                    <label for="hovaten">Họ và tên</label>
                    <div style="color: red; font-weight: initial;" id="errorTen"></div>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <div class="form-floating" style="width: 60%; padding-right: 20px;">
                        <input type="text" class="form-control" id="email" placeholder="name@example.com">
                        <label for="email">Email</label>
                        <div style="color: red; font-weight: initial;" id="errorEmail"></div>
                    </div>
                    <div class="form-floating" style="width: 40%;">
                        <input type="text" class="form-control" id="sdt" placeholder="Số điện thoại">
                        <label for="sdt">Số điện thoại</label>
                        <div style="color: red; font-weight: initial;" id="errorSDT"></div>
                    </div>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="diachi" placeholder="Địa chỉ">
                    <label for="diachi">Địa chỉ</label>
                    <div style="color: red; font-weight: initial;" id="errorDiaChi"></div>
                </div>
                <div class="d-flex justify-content-between mb-4">
                    <div class="form-floating" style="padding-right: 10px; width: 250px;">
                        <select class="form-select" id="tinh" aria-label="Floating label select example">
                            <option value="" selected>Tỉnh/Thành phố</option>
                        </select>
                        <label for="tinh">Tỉnh/thành phố</label>
                        <div style="color: red; font-weight: initial;" id="errorTinh"></div>
                    </div>
                    <div class="form-floating" style="padding-right: 10px; width: 250px;">
                        <select class="form-select" id="huyen" aria-label="Floating label select example">
                            <option value="" selected>Quận/Huyện</option>
                        </select>
                        <label for="huyen">Quận/huyện</label>
                        <div style="color: red; font-weight: initial;" id="errorHuyen"></div>
                    </div>
                    <div class="form-floating" style="width: 250px;">
                        <select class="form-select" id="xa" aria-label="Floating label select example">
                            <option value="" selected>Phường/Xã</option>
                        </select>
                        <label for="xa">Phường/xã</label>
                        <div style="color: red; font-weight: initial;" id="errorXa"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <a th:href="@{/cart}" style="color: black; font-weight: bold; font-size: 16px; text-decoration: none; text-transform: none;">Giỏ hàng</a>
                    <button onclick="layDiaChi()" type="submit" id="button_left1" style="background-color: rgb(249,72,42);color: white; padding: 5px 10px; width: 40%; height: 50px; border-radius: 10px; border-color: rgb(249,72,42);">Tiếp tục đến phương thức thanh toán</button>
                </div>
            </form>
        </div>
        <div id="left2" class="left2">
            <img class="logo" src="../dist/img/logo_bong2.jpg" height="70" width="130">
            <p style="color: red; margin: 0;padding: 0;">Mang đến sự tự tin trong bạn</p>
            <h6 style="margin-top: 50px;">THÔNG TIN GIAO HÀNG</h6>
            <div class="d-flex justify-content-start mt-4">
                <div style="margin-right: 15px;">
                    <img src="../dist/img/user7-128x128.jpg" style="border-radius: 7px;" width="70px" height="70px">
                </div>
                <p style="padding-top: 7px;" th:if="${token} !=''" th:text="${tenKH} + ' (' +${emailKH}+ ')'">

<!--                    Văn Hoa Nguyễn (nguyeenxvawnhoa@gmail.com)-->
<!--                    <br>-->
<!--                    <a href="#" style="color: rgb(249,72,42); text-decoration: none; text-transform: none;">Đăng xuất</a>-->
                </p>
            </div>
            <form class="mt-4" id="formDiaChiKhachCoTaiKhoan" onsubmit="return validateFormDiaChiKhachCotaiKhoan(event)">
                <div class="form-floating mb-3">
                    <select class="form-select" id="diachidaluu" aria-label="Floating label select example" onchange="HienDiaChiDaChon()">
                        <option th:value="-1">Thêm địa chỉ mới</option>
                        <option th:each=" dc: ${lstDC}"
                                th:selected="${dc.trangthai == true}"
                                th:value="${dc.id}"
                                th:text="${dc.sdtnguoinhan}+ ', '+ ${dc.tenduong}+ ', '+ ${dc.xaphuong}+ ', '+ ${dc.quanhuyen}+ ', '+${dc.tinhthanhpho}">
                        </option>

                    </select>
                    <label for="diachidaluu">Địa chỉ đã lưu</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="hovaten2" placeholder="Họ và tên">
                    <label for="hovaten2">Họ và tên</label>
                    <div style="color: red; font-weight: initial;" id="errorTen2"></div>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="sdt2" placeholder="Số điện thoại">
                    <label for="sdt2">Số điện thoại</label>
                    <div style="color: red; font-weight: initial;" id="errorSDT2"></div>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="diachi2" placeholder="Địa chỉ">
                    <label for="diachi2">Địa chỉ</label>
                    <div style="color: red; font-weight: initial;" id="errorDiaChi2"></div>
                </div>
                <div class="d-flex justify-content-between mb-4">
                    <div class="form-floating" style="padding-right: 10px; width: 250px;">
                        <select class="form-select" id="tinh2" aria-label="Floating label select example">
                            <option selected>Tỉnh/Thành phố</option>
                        </select>
                        <label for="tinh2">Tỉnh/thành phố</label>
                        <div style="color: red; font-weight: initial;" id="errorTinh2"></div>
                    </div>
                    <div class="form-floating" style="padding-right: 10px; width: 250px;">
                        <select class="form-select" id="huyen2" aria-label="Floating label select example">
                            <option selected>Quận/huyện</option>
                        </select>
                        <label for="huyen2">Quận/huyện</label>
                        <div style="color: red; font-weight: initial;" id="errorHuyen2"></div>
                    </div>
                    <div class="form-floating" style="width: 250px;">
                        <select class="form-select" id="xa2" aria-label="Floating label select example">
                            <option selected>Phường/xã</option>
                        </select>
                        <label for="xa2">Phường/xã</label>
                        <div style="color: red; font-weight: initial;" id="errorXa2"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <a th:href="@{/cart}" style="color: black; font-weight: bold; font-size: 16px; text-decoration: none; text-transform: none;">Giỏ hàng</a>
                    <button onclick="layDiaChi2()" type="submit" id="button_left2" style="background-color: rgb(249,72,42);color: white; padding: 5px 10px; width: 40%; height: 50px; border-radius: 10px; border-color: rgb(249,72,42);">Tiếp tục đến phương thức thanh toán</button>
                </div>
            </form>
        </div>
        <div id="left3" class="left3">
            <img class="logo" src="../dist/img/logo_bong2.jpg" height="70" width="130">
            <p style="color: red; margin: 0;padding: 0;">Mang đến sự tự tin trong bạn</p>
            <h6 style="margin-top: 50px; margin-bottom: 25px;">MIỄN PHÍ VẬN CHUYỂN</h6>
            <ul class="list-group">
                <li class="list-group-item" style="width: 100%; height: 70px;">
                    <div class="opciones-radio">
                        <div class="form-group" style="padding-top: 7px;">
                            <span class="opcion-radio">
                                <input type="radio" id="kiemtramienphiship" name="abc" disabled>
                                <label for="kiemtramienphiship">Miễn phí vận chuyển cho đơn hàng từ 2 triệu</label>
                            </span>
                        </div>
                    </div>
                </li>
            </ul>
            <h6 style="margin-top: 35px; margin-bottom: 25px;">PHƯƠNG THỨC THANH TOÁN</h6>
            <ul class="list-group">
                <li class="list-group-item" style="width: 100%; height: 70px;">
                    <div class="opciones-radio">
                        <div class="form-group" style="padding-top: 7px;">
                        <span class="opcion-radio">
                            <input type="radio" id="nhanhang" name="pttt" checked onchange="radioChanged(this)">
                            <label for="nhanhang">
                                <img class="main-img" src="https://hstatic.net/0/0/global/design/seller/image/payment/cod.svg?v=6">
                                Thanh toán khi nhận hàng (COD)</label>
                        </span>
                        </div>
                    </div>
                </li>
                <li class="list-group-item" style="width: 100%; height: 70px;">
                    <div class="opciones-radio">
                        <div class="form-group" style="padding-top: 7px;">
                        <span class="opcion-radio">
                            <input type="radio" id="vnpay" name="pttt" onchange="radioChanged(this)">
                            <label for="vnpay">
                                <img class="main-img" th:src="@{/img/logovnpay.png}" height="45" width="45">
                                Thanh toán qua ví điện tử VNPay</label>
                        </span>
                            </div>
                        </div>
                </li>
            </ul>
            <form id="formNhanHang" th:action="@{/customer/thanh-toan-online-khach-le}" th:object="${diachikotaikhoan}" method="post" onsubmit="return SubmitFormNhanHangTraSau()">
                <input type="hidden" id="hotennhan" th:field="*{hovaten}"  value="">
                <input type="hidden" id="emailnhan" th:field="*{email}" value="">
                <input type="hidden" id="sdtnhan" th:field="*{sodienthoai}" value="">
                <input type="hidden" id="diachinhan" th:field="*{diachicuthe}" value="">
                <input type="hidden" id="tinhnhan" th:field="*{tinhthanhpho}" value="">
                <input type="hidden" id="huyennhan" th:field="*{quanhuyen}" value="">
                <input type="hidden" id="xanhan" th:field="*{phuongxa}" value="">

                <input type="hidden" id="maCodeGiam1" name="maCodeGiam" value="">
                <input type="hidden" id="phivanchuyen1" name="phivanchuyen" value="">
                <input type="hidden" id="ngaygiaodukiens1" name="ngaygiaodukien" value="">
                <input type="hidden" id="tongtien1" name="tongtien" value="">
                <input type="hidden" id="tamtinh1" name="tamtinh" value="">
                <input type="hidden" id="sotiengiam1" name="sotiengiam" value="">
                <div class="d-flex justify-content-between align-items-center mb-4" style="margin-top: 30px;">
                    <a onclick="quaylai1()" style="color: black; font-weight: bold; font-size: 16px; text-decoration: none; text-transform: none; cursor: pointer;">Thông tin giao hàng</a>
                    <button onclick="layGiaTri()" type="submit" style="background-color: rgb(249,72,42);color: white; padding: 5px 10px; width: 40%; height: 50px; border-radius: 10px; border-color: rgb(249,72,42);">Hoàn tất đơn hàng</button>
                </div>
            </form>
            <form id="formVNPay" th:action="@{/submitOrder}" th:object="${diachikotaikhoan}" method="post" onsubmit="return SubmitFormNhanHangTraTruoc()">

                <input type="hidden" id="hotennhanVNPay" th:field="*{hovaten}"  value="">
                <input type="hidden" id="emailnhanVNPay" th:field="*{email}" value="">
                <input type="hidden" id="sdtnhanVNPay" th:field="*{sodienthoai}" value="">
                <input type="hidden" id="diachinhanVNPay" th:field="*{diachicuthe}" value="">
                <input type="hidden" id="tinhnhanVNPay" th:field="*{tinhthanhpho}" value="">
                <input type="hidden" id="huyennhanVNPay" th:field="*{quanhuyen}" value="">
                <input type="hidden" id="xanhanVNPay" th:field="*{phuongxa}" value="">

                <input type="hidden" id="maCodeGiam2" name="maCodeGiamVNPay" value="">
                <input type="hidden" id="phivanchuyen2" name="phivanchuyenVNPay" value="">
                <input type="hidden" id="ngaygiaodukiens2" name="ngaygiaodukienVNPay" value="">
                <input type="hidden" id="tongtien2" name="tongtienVNPay" value="">
                <input type="hidden" id="tamtinh2" name="tamtinhVNPay" value="">
                <input type="hidden" id="sotiengiam2" name="sotiengiamVNPay" value="">

                <input type="hidden" id="amount" name="amount" value="">
                <input type="hidden" id="orderInfo" name="orderInfo" value="Tuan Anh">
                <div class="d-flex justify-content-between align-items-center mb-4" style="margin-top: 30px;">
                    <a onclick="quaylai2()" style="color: black; font-weight: bold; font-size: 16px; text-decoration: none; text-transform: none; cursor: pointer;">Thông tin giao hàng</a>
                    <button onclick="layGiaTriVNPay()" type="submit" style="background-color: rgb(249,72,42);color: white; padding: 5px 10px; width: 40%; height: 50px; border-radius: 10px; border-color: rgb(249,72,42);">Hoàn tất đơn hàng</button>
                </div>
            </form>


        </div>
    </div>
    <div class="right">
        <table>
            <tbody>
            <div>
                <tr th:each="item, iterStat : ${cartItems}">
                    <td class="anhsp" style="width: 15%; position: relative;">
                        <div th:id="'carouselExample' + ${item.id}" class="carousel">
                            <div class="carousel-inner">
                                <th:block th:each="anh, index : ${item.sanphamchitiet.anh}">
                                    <div th:classappend="${index.index == 0} ? 'carousel-item active' : 'carousel-item'">
                                        <img th:if="${anh.tenanh != null}"
                                             th:src="@{'/upload' + ${anh.tenanh.substring(anh.tenanh.lastIndexOf('upload') + 6)}}"
                                             class="d-block w-100" style="width: 100%; height: 70px;" alt="Ảnh">
                                    </div>
                                </th:block>
                            </div>
                            <button class="carousel-control-prev" type="button" th:data-bs-target="'#carouselExample' + ${item.id}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" th:data-bs-target="'#carouselExample' + ${item.id}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                        <span class="position-absolute badge rounded-pill bg-danger" style="top: 0; left: 90%; transform: translate(-50%, -50%); width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border-radius: 50%;" th:text="${item.soluong}"></span>
                    </td>

                    <td style="width: 60%; padding-left: 15px;">
                        <h8 style="margin: 0;padding-top: 0;" th:text="${item.sanphamchitiet.sanpham.tensanpham}"></h8>
                        <p style="margin: 0; padding-top: 0;">
                            <span th:text="${item.sanphamchitiet.mausac.ten}" th:style="'background-color: ' + ${item.sanphamchitiet.mausac.ten} + '; color: white;'"></span>
                            <span th:text="${item.sanphamchitiet.kichco.ten}"></span>
                        </p>
                    </td>
                    <td style="width: 25%; text-align: right;">
                        <div class="d-flex justify-content-end align-items-center">
                            <b th:text="${#numbers.formatDecimal(item.sanphamchitiet.giatien * item.soluong, 0, 'COMMA', 0, 'POINT') + '&#x20ab;'}"></b>
                        </div>
                    </td>
                </tr>
                <tr class="spacer-row"><td colspan="3"></td></tr>

            </div>
            </tbody>
        </table>
        <hr>
        <div class="d-flex justify-content-between mb-3">
            <div class="form-floating" style="width: 70%; padding-right: 20px;">
                <input type="text" class="form-control" id="magiamgia" placeholder="Mã giảm giá">
                <label for="magiamgia">Mã giảm giá</label>
                <div style="color: red; font-weight: initial;" id="errorMaGiam"></div>
            </div>
            <button id="suDungPhieuGiam" style="background-color: rgb(249,72,42);color: white; padding: 5px 10px; width: 30%; height: 55px; border-radius: 10px; border-color: rgb(249,72,42);">Sử dụng</button>
        </div>
        <div class="xemthem" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
            <svg width="15" height="10" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M17.3337 5.3335V2.00016C17.3337 1.07516 16.5837 0.333496 15.667 0.333496H2.33366C1.41699 0.333496 0.675326 1.07516 0.675326 2.00016V5.3335C1.59199 5.3335 2.33366 6.0835 2.33366 7.00016C2.33366 7.91683 1.59199 8.66683 0.666992 8.66683V12.0002C0.666992 12.9168 1.41699 13.6668 2.33366 13.6668H15.667C16.5837 13.6668 17.3337 12.9168 17.3337 12.0002V8.66683C16.417 8.66683 15.667 7.91683 15.667 7.00016C15.667 6.0835 16.417 5.3335 17.3337 5.3335ZM15.667 4.11683C14.6753 4.69183 14.0003 5.77516 14.0003 7.00016C14.0003 8.22516 14.6753 9.3085 15.667 9.8835V12.0002H2.33366V9.8835C3.32533 9.3085 4.00033 8.22516 4.00033 7.00016C4.00033 5.76683 3.33366 4.69183 2.34199 4.11683L2.33366 2.00016H15.667V4.11683ZM9.83366 9.50016H8.16699V11.1668H9.83366V9.50016ZM8.16699 6.16683H9.83366V7.8335H8.16699V6.16683ZM9.83366 2.8335H8.16699V4.50016H9.83366V2.8335Z" fill="#318DBB"></path>
            </svg>
            <span>Xem thêm mã giảm giá</span>
        </div>
        <div style="justify-content: center;">
            <span th:each="p,stt:${lstPGG}" class="qaz" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                <span th:if="${p.loaiphieu}" th:text="'Giảm '+${p.giatrigiam}+' %'"></span>
                <span th:if="${!p.loaiphieu}" th:text="'Giảm '+${#numbers.formatDecimal(p.giatrigiam, 0, 'COMMA', 0, 'POINT')}+' ₫'"></span>
            </span>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="width: 430px;">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: #EEEEEE;">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">Danh sách phiếu khuyến mãi:</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="background-color: #e6f2f4;">
                        <div th:each="p,stt:${lstPGG}" class="ma_giam_gia">
                            <div class="ma-item-left">
                                <img class="anh_ma" src="../dist/img/anhgiamgia.webp">
                            </div>
                            <div class="ma-item-right">
                                <h4 th:if="${p.loaiphieu}" th:text="'Giảm '+${p.giatrigiam}+' %'" style="font-size: 14px; font-weight: 700; margin: 0; padding: 0;"></h4>
                                <h4 th:if="${!p.loaiphieu}" th:text="'Giảm '+${#numbers.formatDecimal(p.giatrigiam, 0, 'COMMA', 0, 'POINT')}+' ₫'" style="font-size: 14px; font-weight: 700; margin: 0; padding: 0;"></h4>
                                <p th:if="${p.dontoithieu == null}" th:text="'Áp dụng cho mọi hóa đơn'" style="font-size: 14px; margin: 0; padding: 0; color: black"></p>
                                <p th:if="${p.dontoithieu!=null}" th:text="'Áp dụng cho hóa đơn từ '+${#numbers.formatDecimal(p.dontoithieu, 0, 'COMMA', 0, 'POINT')}+' ₫'" style="font-size: 14px; margin: 0; padding: 0; color: black"></p>
                                <p th:if="${p.giatrigiamtoida!=null}" th:text="'Giảm tối đa '+${#numbers.formatDecimal(p.giatrigiamtoida, 0, 'COMMA', 0, 'POINT')}+' ₫'" style="font-size: 14px; margin: 0; padding: 0; color: black"></p>
                                <div class="ma-item-des">
                                    <div class="left_magiam">
                                        <p style="margin: 0; white-space: nowrap;">Mã: <b class="code" th:text="${p.macode}"></b></p>
                                        <p th:text="'HSD: '+${p.ngayketthuc}"></p>
                                    </div>
                                    <div class="right_magiam apDungMaGiam" id="apDungMaGiam" th:data-id="${p.id}" data-bs-dismiss="modal">
                                        Áp dụng
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div class="d-flex justify-content-between align-items-center">
            <p style="color: #AAAAAA; font-size: 18px;">Tạm tính</p>
            <div style="display: flex; align-items: center;">
                <h5 id="tamTinh" th:text="${#numbers.formatDecimal(totalAmount, 0, 'COMMA', 0, 'POINT') + ' &#x20ab;'}"></h5>
            </div>
        </div>
        <div id="fillMaGiam">
            <div class="d-flex justify-content-between align-items-center mb-3" style="align-items: center;">
                <div class="d-flex justify-content-start">
                    <span style="color: #AAAAAA; font-size: 18px; padding-right: 10px;">Mã giảm giá</span>
                    <span class="applied-reduction-code">
                    <svg width="16" height="15" xmlns="http://www.w3.org/2000/svg" class="applied-reduction-code-icon" fill="#CE4549"><path d="M14.476 0H8.76c-.404 0-.792.15-1.078.42L.446 7.207c-.595.558-.595 1.463 0 2.022l5.703 5.35c.296.28.687.42 1.076.42.39 0 .78-.14 1.077-.418l7.25-6.79c.286-.268.447-.632.447-1.01V1.43C16 .64 15.318 0 14.476 0zm-2.62 5.77c-.944 0-1.713-.777-1.713-1.732 0-.954.77-1.73 1.714-1.73.945 0 1.714.776 1.714 1.73 0 .955-.768 1.73-1.713 1.73z"></path></svg>
                    <span class="applied-reduction-code-information" id="maCodeGiam">khong</span>
                </span>
                    <div style="padding-left: 5px;" id="form_discount_remove" class="dp-inline-block">
                        <button class="applied-reduction-code-clear-button icon icon-clear" id="xoaPhieuGiam">
                            <span class="visually-hidden">Xóa</span>
                        </button>
                    </div>
                </div>
                <div>
                    <h5 id="soTienGiam">0 ₫</h5>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-between align-items-center">
            <p style="color: #AAAAAA; font-size: 18px;">Phí vận chuyển</p>
            <div style="display: flex; align-items: center;">
                <h5 id="phivanchuyen">0 ₫</h5>
            </div>
        </div>
        <hr>
        <div class="d-flex justify-content-between align-items-center">
            <p style="color: #000; font-size: 20px;">Tổng cộng</p>
            <div style="display: flex; align-items: center;">
                <h4 style="color: #000;" id="tongtien"></h4>
            </div>
        </div>
        <div class="d-flex justify-content-between align-items-center">
            <p style="color: #000; font-size: 20px;">Ngày giao dự kiến</p>
            <div style="display: flex; align-items: center;">
                <h7 style="color: #000;" id="ngaygiaodukiens" ></h7>
            </div>
        </div>
        <div style="position: relative; padding: 10px 0; color: #666;">
            <div style="position: relative; z-index: 1;text-align: center;">
                <span style="background: #f2f2f2; padding: 0 15px;">Lý do bạn chọn FSPORT</span>
                <span style="position: absolute; height: 1px; width: 100%; top: 50%; background: #dfdfdf;left: 0;z-index: -1;"></span>
            </div>
            <div class="wyuscs" style="overflow: auto;margin-top: 16px;">
                <div class="wyuscs1" style="float: left;width: 20%">
                    <img style="max-width: 64px;" src="https://file.hstatic.net/1000230642/file/0x500_mail-truck-64e12_05e20103f8814bcfb554c07e67ba839f.png">
                </div>
                <div class="wyuscs2" style="float:right;width: 80%;">
                    <strong style="font-weight: bolder;color: #000;font-size: 1.1em;">Hơn 800.000 đơn hàng được FSPORT vận chuyển đến tay khách hàng thành công.</strong>
                    <p>FSPORT luôn làm đảm bảo khách hàng hài lòng khi nhận sản phẩm. Bạn chỉ cần đặt hàng giao hàng hãy để đội ngũ FSPORT lo.</p>
                </div>
            </div>
            <div class="wyuscs" style="overflow: auto;margin-top: 16px;">
                <div class="wyuscs1" style="float: left;width: 20%">
                    <img style="max-width: 64px;" src="https://file.hstatic.net/1000230642/file/reload_44f0185e8a834a108fb386db12182dd3.png">
                </div>
                <div class="wyuscs2" style="float:right;width: 80%">
                    <span style="font-weight: bolder;color: #000;font-size: 1.1em;">An tâm đặt hàng online với chính sách đổi trả</span>
                    <p>FSPORT có chính sách đổi hàng tại quầy trong vòng 7 ngày.</p>
                </div>
            </div>
        </div>
    </div>
</div>
<nav th:replace="~{/layout/footer.html}"></nav>
<!-- footer end -->
<script>
    var token= document.getElementById("kiemtratokendangnhap").value;
    function quaylai1(){
        if(token !== ""){
            document.getElementById("left2").style.display = "block";
            document.getElementById("left1").style.display = "none";
            document.getElementById("left3").style.display = "none";

        }else{
            document.getElementById("left1").style.display = "block";
            document.getElementById("left2").style.display = "none";
            document.getElementById("left3").style.display = "none";
        }
    }
    function quaylai2(){
        if(token !== ""){
            document.getElementById("left2").style.display = "block";
            document.getElementById("left1").style.display = "none";
            document.getElementById("left3").style.display = "none";

        }else{
            document.getElementById("left1").style.display = "block";
            document.getElementById("left2").style.display = "none";
            document.getElementById("left3").style.display = "none";
        }
    }
    function SubmitFormNhanHangTraSau(){
        Swal.fire({
            title: 'Bạn có chắc chắn muốn đặt hàng không?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Có',
            cancelButtonText: 'Không'
        }).then((result) => {
            if (result.isConfirmed) {
                // Nếu người dùng nhấn Có, hiển thị thông báo thành công và chuyển hướng sau một khoảng thời gian
                const Toast = Swal.mixin({
                    toast: true,
                    position: "top-end",
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }
                });

                // Toast.fire({
                //     icon: "success",
                //     title: "Thêm thành công!"
                // });

                setTimeout(function () {
                    document.getElementById("formNhanHang").submit();
                }, 500);
            }
        });
        // Ngăn form được gửi đi ngay lập tức
        return false;
    }

    function SubmitFormNhanHangTraTruoc(){
        Swal.fire({
            title: 'Bạn có chắc chắn muốn thanh toán trước đơn hàng không?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Có',
            cancelButtonText: 'Không'
        }).then((result) => {
            if (result.isConfirmed) {
                // Nếu người dùng nhấn Có, hiển thị thông báo thành công và chuyển hướng sau một khoảng thời gian
                const Toast = Swal.mixin({
                    toast: true,
                    position: "top-end",
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }
                });

                // Toast.fire({
                //     icon: "success",
                //     title: "Thêm thành công!"
                // });

                setTimeout(function () {
                    document.getElementById("formVNPay").submit();
                }, 500);
            }
        });
        // Ngăn form được gửi đi ngay lập tức
        return false;
    }
    document.getElementById("formVNPay").style.display = "none";
    function radioChanged(radio) {
        if (radio.id === "nhanhang") {
            document.getElementById("formVNPay").style.display = "none";
            document.getElementById("formNhanHang").style.display = "block";
        } else if (radio.id === "vnpay") {
            document.getElementById("formVNPay").style.display = "block";
            document.getElementById("formNhanHang").style.display = "none";
        }
    }
    function layGiaTriVNPay(){
        var tong = document.getElementById('tongtien').innerText;
        document.getElementById('amount').value = tong;

        var maCode = document.getElementById('maCodeGiam').innerText;
        var phi = document.getElementById('phivanchuyen').innerText;
        var tong = document.getElementById('tongtien').innerText;
        var ngay = document.getElementById('ngaygiaodukiens').innerText;
        var tamTinh = document.getElementById('tamTinh').innerText;
        var soTienGiam = document.getElementById('soTienGiam').innerText;


        // Đưa nội dung vào input hidden

        document.getElementById('maCodeGiam2').value = maCode;
        document.getElementById('phivanchuyen2').value = phi;
        document.getElementById('tongtien2').value = tong;
        document.getElementById('ngaygiaodukiens2').value = ngay;
        document.getElementById('tamtinh2').value = tamTinh;
        document.getElementById('sotiengiam2').value = soTienGiam;


    }
    if(token !== ""){
        document.getElementById("left2").style.display = "block";
        document.getElementById("left1").style.display = "none";
        document.getElementById("left3").style.display = "none";

    }else{
        document.getElementById("left1").style.display = "block";
        document.getElementById("left2").style.display = "none";
        document.getElementById("left3").style.display = "none";
    }
    document.getElementById("fillMaGiam").style.display = "none";

    // document.getElementById("button_left2").addEventListener("click", function(event) {
    //     event.preventDefault();
    //     document.getElementById("left1").style.display = "none";
    //     document.getElementById("left2").style.display = "none";
    //     document.getElementById("left3").style.display = "block";
    // });

</script>
<script>
    var citis = document.getElementById("tinh");
    var districts = document.getElementById("huyen");
    var wards = document.getElementById("xa");
    var Parameter = {
        url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
        method: "GET",
        responseType: "application/json",
    };
    var promise = axios(Parameter);
    promise.then(function (result) {
        renderCity(result.data);
    });

    function renderCity(data) {
        for (const x of data) {
            var opt = document.createElement('option');
            opt.value = x.Name;
            opt.text = x.Name;
            opt.setAttribute('data-id', x.Id);
            citis.options.add(opt);
            // citis2.options.add(opt);
        }
        citis.onchange = function () {
            districts.length = 1;
            wards.length = 1;
            if (this.options[this.selectedIndex].dataset.id != "") {
                const result = data.filter(n => n.Id === this.options[this.selectedIndex].dataset.id);

                for (const k of result[0].Districts) {
                    var opt = document.createElement('option');
                    opt.value = k.Name;
                    opt.text = k.Name;
                    opt.setAttribute('data-id', k.Id);
                    districts.options.add(opt);
                }
            }
        };
        districts.onchange = function () {
            wards.length = 1;
            const dataCity = data.filter((n) => n.Id === citis.options[citis.selectedIndex].dataset.id);
            if (this.options[this.selectedIndex].dataset.id != "") {
                const dataWards = dataCity[0].Districts.filter(n => n.Id === this.options[this.selectedIndex].dataset.id)[0].Wards;

                for (const w of dataWards) {
                    var opt = document.createElement('option');
                    opt.value = w.Name;
                    opt.text = w.Name;
                    opt.setAttribute('data-id', w.Id);
                    wards.options.add(opt);
                }
            }
        };
    }
    var citis2 = document.getElementById("tinh2");
    var districts2 = document.getElementById("huyen2");
    var wards2 = document.getElementById("xa2");
    var dataCities = [];
    var Parameter2 = {
        url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
        method: "GET",
        responseType: "application/json",
    };

    axios(Parameter2).then(function (result) {
        dataCities = result.data;
        renderCity2(dataCities);
    });

    function renderCity2(data) {
        for (const x of data) {
            var opt = document.createElement('option');
            opt.value = x.Name;
            opt.text = x.Name;
            opt.setAttribute('data-id', x.Id);
            citis2.options.add(opt);

        }
        citis2.onchange = function () {
            districts2.length = 1;
            wards2.length = 1;
            if (this.options[this.selectedIndex].dataset.id != "") {
                const result = data.filter(n => n.Id === this.options[this.selectedIndex].dataset.id);

                for (const k of result[0].Districts) {
                    var opt = document.createElement('option');
                    opt.value = k.Name;
                    opt.text = k.Name;
                    opt.setAttribute('data-id', k.Id);
                    districts2.options.add(opt);
                }
            }
        };
        districts2.onchange = function () {
            wards2.length = 1;
            const dataCity = data.filter((n) => n.Id === citis2.options[citis2.selectedIndex].dataset.id);
            if (this.options[this.selectedIndex].dataset.id != "") {
                const dataWards = dataCity[0].Districts.filter(n => n.Id === this.options[this.selectedIndex].dataset.id)[0].Wards;

                for (const w of dataWards) {
                    var opt = document.createElement('option');
                    opt.value = w.Name;
                    opt.text = w.Name;
                    opt.setAttribute('data-id', w.Id);
                    wards2.options.add(opt);
                }
            }
        };
    }


    function checkCoKhoangTrang(str) {
        // Sử dụng biểu thức chính quy để kiểm tra có khoảng trắng giữa hai từ không
        return /\s/.test(str.trim());
    }

    function checkNhieuKhoangTrang(str) {
        // Sử dụng biểu thức chính quy để tìm các mẫu có ít nhất hai khoảng trắng liên tiếp giữa các từ
        return /\s{2,}/.test(str.trim());
    }

    function validateTen(inputString) {
        // Biểu thức chính quy cho phép các ký tự Latinh, số từ 0-9 và có độ dài từ 5 đến 15 ký tự
        const regex = /^[a-zA-ZàÀảẢãÃáÁạẠăĂằẰẳẲẵẴắẮặẶâÂầẦẩẨẫẪấẤậẬèÈẻẺẽẼéÉẹẸêÊềỀểỂễỄếẾệỆìÌỉỈĩĨíÍịỊòÒỏỎõÕóÓọỌôÔồỒổỔỗỖốỐộỘơƠờỜởỞỡỠớỚợỢùÙủỦũŨúÚụỤưƯừỪửỬữỮứỨựỰýÝđĐ ]{1,50}$/;
        return regex.test(inputString);
    }

    function validateEmail(email) {
        const re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        return re.test(email);
    }

        function validatePhoneNumber(phoneNumber) {
            const regex = /^(0[1-9])+([0-9]{8})\b$/;
            return regex.test(phoneNumber);
        }

        //chuyển tên city để so sánh
        function extractLocation(input) {
            // Chuyển chuỗi về dạng chữ thường để so sánh
            const lowerCaseInput = input.toLowerCase();

            // Kiểm tra và tách từ "tỉnh" hoặc "thành phố"
            if (lowerCaseInput.startsWith("tỉnh ")) {
                // Tách từ "tỉnh" và lấy phần còn lại
                const province = input.slice(5).trim();
                return {type: "tỉnh", name: province};
            } else if (lowerCaseInput.startsWith("thành phố ")) {
                // Tách từ "thành phố" và lấy phần còn lại
                const city = input.slice(10).trim();
                return {type: "thành phố", name: city};
            } else {
                return {type: "unknown", name: input.trim()};
            }
        }

        function callIdCity(thanhpho, huyen, xa) {
            var tencity = extractLocation(thanhpho);
            var tenhuyen = huyen;
            var tenxa = xa;

            var idCityreturn;
            var idHuyenreturn;
            var idXareturn;

            var Parameter = {
                url: "https://online-gateway.ghn.vn/shiip/public-api/master-data/province",
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc"
                }
            };
            axios(Parameter)
                .then(function (a) {
                    return a.data;
                })
                .then(function (b) {
                    // tách id thành phố
                    for (const id of b.data) {
                        if (id.ProvinceName.toLowerCase() === tencity.name.toLowerCase()) {
                            idCityreturn = id.ProvinceID;
                        }
                    }

                    var requestDataHuyen = {
                        province_id: idCityreturn
                    };

                    // Cấu hình yêu cầu với axios, bao gồm Token và dữ liệu gửi đi
                    var ParameterHuyen = {
                        url: "https://online-gateway.ghn.vn/shiip/public-api/master-data/district",
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc"
                        },
                        data: JSON.stringify(requestDataHuyen)
                    };

                    // Gửi yêu cầu và xử lý phản hồi
                    axios(ParameterHuyen)
                        .then(function (response) {
                            return response.data;
                        })
                        .then(function (d) {
                            //tách id huyện
                            for (const id of d.data) {
                                if (id.DistrictName.toLowerCase() === tenhuyen.toLowerCase()) {
                                    idHuyenreturn = id.DistrictID;
                                }
                            }
                            //tách id xã
                            var requestData = {
                                district_id: idHuyenreturn
                            };

                            // Cấu hình yêu cầu với axios, bao gồm Token và dữ liệu gửi đi
                            var Parameter = {
                                url: "https://online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id",
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                    "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc"
                                },
                                data: JSON.stringify(requestData)
                            };

                            // Gửi yêu cầu và xử lý phản hồi
                            axios(Parameter)
                                .then(function (response) {
                                    return response.data;
                                })
                                .then(function (d) {
                                    //tách id xã
                                    for (const id of d.data) {
                                        if (id.WardName.toLowerCase() === tenxa.toLowerCase()) {
                                            idXareturn = id.WardCode;
                                        }
                                    }
                                    var requestDataDate = {
                                        from_district_id: 3440,//địa chỉ mặc địch của shop
                                        from_ward_code: "13007",//địa chỉ mặc địch của shop
                                        to_district_id: idHuyenreturn,
                                        to_ward_code: idXareturn.toString(),
                                        service_id: 53320
                                    };
                                    // Cấu hình yêu cầu với axios, bao gồm Token và dữ liệu gửi đi
                                    var ParameterDate = {
                                        url: "https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/leadtime",
                                        method: "POST",
                                        headers: {
                                            "Content-Type": "application/json",
                                            "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc",
                                            "ShopId": "5115739"
                                        },
                                        data: JSON.stringify(requestDataDate)
                                    };
                                    // Gửi yêu cầu và xử lý phản hồi
                                    axios(ParameterDate)
                                        .then(function (response) {
                                            return response.data; // In dữ liệu ra console
                                        })
                                        .then(function (d) {
                                            // Số nguyên đại diện cho một thời điểm trong JavaScript (ví dụ: số giây kể từ Epoch)
                                            var timestamp = d.data.leadtime;
                                            var date = new Date(timestamp * 1000);

                                            // Lấy ngày, tháng, năm từ đối tượng Date
                                            var day = date.getDate();
                                            var month = date.getMonth() + 1; // Tháng bắt đầu từ 0
                                            var year = date.getFullYear();

                                            // Đảm bảo định dạng dd và mm luôn có hai chữ số
                                            if (day < 10) {
                                                day = '0' + day;
                                            }
                                            if (month < 10) {
                                                month = '0' + month;
                                            }

                                            // Trả về chuỗi định dạng dd/mm/yyyy
                                            var days = day + '/' + month + '/' + year;

                                            document.getElementById('ngaygiaodukiens').innerHTML = days;
                                            // phigiaohang
                                            feship(idHuyenreturn, idXareturn);


                                        })
                                })


                        })
                })

        }

        function convertCashInput(amount) {
            // Chuyển số thành chuỗi và thêm dấu phân cách hàng nghìn
            let formattedAmount = amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            // Thêm ký hiệu tiền tệ ₫ vào cuối chuỗi
            return formattedAmount + " ₫";
        }

        function feship(idhuyen, idxa) {
            var requestData =
                {
                    service_id: 53321,
                    insurance_value: 500000,
                    coupon: null,
                    from_district_id: 3440,
                    to_district_id: idhuyen,
                    to_ward_code: idxa.toString(),
                    height: 15,
                    length: 15,
                    weight: 1000,
                    width: 15
                };
            // Cấu hình yêu cầu với axios, bao gồm Token và dữ liệu gửi đi
            var Parameter = {
                url: "https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/fee",
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Token": "59db4e6a-23e7-11ef-8c74-4ad7faca6bdc",
                    "ShopId": "5115739"
                },
                data: JSON.stringify(requestData)
            };

            // Gửi yêu cầu và xử lý phản hồi
            axios(Parameter)
                .then(function (response) {
                    return response.data // In dữ liệu ra console
                })
                .then(function (d) {
                    var shipfe = convertCashInput(d.data.total);
                    const tamtinh = chuyendoitien(document.getElementById("tamTinh"));
                    console.log("tam tinh phí"+tamtinh);
                    if(tamtinh >= 2000000){
                        document.getElementById('phivanchuyen').innerText= "0 ₫";
                        document.getElementById("kiemtramienphiship").checked= true;
                        tinhtongtien();
                    }else{
                        document.getElementById('phivanchuyen').innerText = shipfe;
                        document.getElementById("kiemtramienphiship").checked= false;
                        tinhtongtien();
                    }

                })

        }

        function tinhtongtien() {
            const tamtinh = chuyendoitien(document.getElementById("tamTinh"));
            const soTienGiam = chuyendoitien(document.getElementById("soTienGiam"));
            const phivanchuyen = chuyendoitien(document.getElementById("phivanchuyen"));
            const tongTien = tamtinh - soTienGiam + phivanchuyen;
            console.log("tongtien"+ tongTien);
            document.getElementById("tongtien").innerText = formatCurrencyVND(tongTien);
        }

        function validateFormDiaChiKhachLe(event) {
            event.preventDefault();
            var inputTen = document.getElementById("hovaten").value;
            var errorTen = document.getElementById("errorTen");
            var isTenValid = true;
            if (inputTen.trim() === "") {
                errorTen.innerText = "Vui lòng nhập họ tên!";
                document.getElementById("hovaten").style.border = "2px solid red";
                isTenValid = false;
            }
            if (inputTen.trim().length > 0) {
                if (checkNhieuKhoangTrang(inputTen)) {
                    errorTen.innerText = "Giữa các từ không được nhiều hơn 1 khoảng trắng!";
                    document.getElementById("hovaten").style.border = "2px solid red";
                    isTenValid = false;
                }
            }
            if (inputTen.trim().length > 0) {
                if (validateTen(inputTen.trim()) === false) {
                    errorTen.innerText = "Họ tên chỉ chứa ký tự và tối đa 50 ký tự!";
                    document.getElementById("hovaten").style.border = "2px solid red";
                    isTenValid = false;
                }
            }
            if (isTenValid) {
                document.getElementById("hovaten").style.border = "";
                errorTen.innerText = "";
            }
            var inputEmail = document.getElementById("email").value;
            var errorEmail = document.getElementById("errorEmail");
            var isEmailValid = true;
            if (inputEmail.trim() === "") {
                errorEmail.innerText = "Địa chỉ email không được trống!";
                document.getElementById("email").style.border = "2px solid red";
                isEmailValid = false;
            }
            // if(inputEmail.trim().length > 0){
            //     if(checkCoKhoangTrang(inputEmail)){
            //         errorEmail.innerText = "Giữa các từ không được nhiều hơn 1 khoảng trắng!";
            //         document.getElementById("email").style.border="2px solid red";
            //         isEmailValid = false;
            //     }
            // }
            if (inputEmail.trim().length > 0) {
                if (validateEmail(inputEmail.trim()) === false) {
                    errorEmail.innerText = "Địa chỉ email sai định dạng!";
                    document.getElementById("email").style.border = "2px solid red";
                    isEmailValid = false;
                }
            }
            if (isEmailValid) {
                document.getElementById("email").style.border = "";
                errorEmail.innerText = "";
            }
            var inputSDT = document.getElementById("sdt").value;
            var errorSDT = document.getElementById("errorSDT");
            var isSDTValid = true;

            if (inputSDT.trim() === "") {
                errorSDT.innerText = "Số điện thoại không được trống!";
                document.getElementById("sdt").style.border = "2px solid red";
                isSDTValid = false;
            }

            if (inputSDT.trim().length > 0) {
                if (validatePhoneNumber(inputSDT.trim()) === false) {
                    errorSDT.innerText = "Số điện thoại sai định dạng!";
                    document.getElementById("sdt").style.border = "2px solid red";
                    isSDTValid = false;
                }
            }
            if (isSDTValid) {
                document.getElementById("sdt").style.border = "";
                errorSDT.innerText = "";
            }

            var inputDiaChi = document.getElementById("diachi").value;
            var errorDiaChi = document.getElementById("errorDiaChi");
            var isDiaChiValid = true;

            if (inputDiaChi.trim() === "") {
                errorDiaChi.innerText = "Địa chỉ không được trống!";
                document.getElementById("diachi").style.border = "2px solid red";
                isDiaChiValid = false;
            }

            if (inputDiaChi.trim().length > 0) {
                if (checkNhieuKhoangTrang(inputDiaChi)) {
                    errorDiaChi.innerText = "Giữa các từ không được nhiều hơn 1 khoảng trắng!";
                    document.getElementById("diachi").style.border = "2px solid red";
                    isDiaChiValid = false;
                }
            }
            if (inputDiaChi.trim().length > 0) {
                if (inputDiaChi.trim().length > 50) {
                    errorDiaChi.innerText = "Địa chỉ tối ta 50 ký tự!";
                    document.getElementById("diachi").style.border = "2px solid red";
                    isDiaChiValid = false;
                }
            }
            if (isDiaChiValid) {
                document.getElementById("diachi").style.border = "";
                errorDiaChi.innerText = "";
            }

            var inputTinh = document.getElementById("tinh");
            var errorTinh = document.getElementById("errorTinh");
            var isTinhValid = true;

            if (inputTinh.options[0].selected) {
                errorTinh.innerText = "Vui lòng chọn tỉnh thành!";
                document.getElementById("tinh").style.border = "2px solid red";
                isTinhValid = false;
            }
            if (isTinhValid) {
                document.getElementById("tinh").style.border = "";
                errorTinh.innerText = "";
            }

            var inputHuyen = document.getElementById("huyen");
            var errorHuyen = document.getElementById("errorHuyen");
            var isHuyenValid = true;

            if (inputHuyen.options[0].selected) {
                errorHuyen.innerText = "Vui lòng chọn quận huyện!";
                document.getElementById("huyen").style.border = "2px solid red";
                isHuyenValid = false;
            }
            if (isHuyenValid) {
                document.getElementById("huyen").style.border = "";
                errorHuyen.innerText = "";
            }

            var inputXa = document.getElementById("xa");
            var errorXa = document.getElementById("errorXa");
            var isXaValid = true;

            if (inputXa.options[0].selected) {
                errorXa.innerText = "Vui lòng chọn phường xã!";
                document.getElementById("xa").style.border = "2px solid red";
                isXaValid = false;
            }
            if (isXaValid) {
                document.getElementById("xa").style.border = "";
                errorXa.innerText = "";
            }

            if (isTenValid && isEmailValid && isSDTValid && isDiaChiValid && isTinhValid && isHuyenValid && isXaValid) {
                document.getElementById("left1").style.display = "none";
                document.getElementById("left2").style.display = "none";
                document.getElementById("left3").style.display = "block";
                var tinh = document.getElementById("tinh").value;
                console.log(tinh);
                var huyen = document.getElementById("huyen").value;
                console.log(huyen);
                var xa = document.getElementById("xa").value;
                console.log(xa);
                callIdCity(tinh, huyen, xa);
                return true;
            } else {
                return false;
            }
        }

        async function getPhieuGiamKhongTaiKhoan() {
            const response = await fetch('/thanh-toan-phieu-giam-khong-tai-khoan');
            return await response.json();
        }

        async function fillPhieuGiamKhongTaiKhoan() {
            const inputTamTinh = document.getElementById('tamTinh');
            // Lấy nội dung văn bản của phần tử
            const inputTamTinhValue = inputTamTinh.innerText || inputTamTinh.textContent;
            // Sử dụng regex để loại bỏ ký tự không phải là số và dấu phẩy
            const numberString = inputTamTinhValue.replace(/[^\d]/g, '');
            // Chuyển chuỗi đã làm sạch thành số nguyên
            const inputTamTinhSoNguyen = parseInt(numberString, 10);
            const lstPGG = await getPhieuGiamKhongTaiKhoan();
            var MangTienGiam = [];
            lstPGG.forEach(p => {
                if (p.dontoithieu === null || p.dontoithieu <= inputTamTinhSoNguyen) {
                    if (p.loaiphieu != null && p.loaiphieu === true) {
                        const sotiengiam = ((p.giatrigiam / 100) * inputTamTinhSoNguyen);
                        if (p.giatrigiamtoida <= sotiengiam) {
                            var newObj = {
                                code: p.macode,
                                value: p.giatrigiamtoida
                            };
                            MangTienGiam.push(newObj);
                        } else {
                            var newObj = {
                                code: p.macode,
                                value: sotiengiam
                            };
                            MangTienGiam.push(newObj);
                        }

                    }
                    if (p.loaiphieu != null && p.loaiphieu === false) {
                        var newObj = {
                            code: p.macode,
                            value: p.giatrigiam
                        };
                        MangTienGiam.push(newObj);

                    }
                }
            })
            if (MangTienGiam.length > 0) {
                var max = MangTienGiam[0];
                for (var i = 1; i < MangTienGiam.length; i++) {
                    if (MangTienGiam[i].value > max.value) {
                        max = MangTienGiam[i];
                    }
                }
                document.getElementById("fillMaGiam").style.display = "block";
                document.getElementById("maCodeGiam").innerText = max.code;
                document.getElementById("soTienGiam").innerText = "-" + formatCurrencyVND(max.value);
                tinhtongtien();
            }else{
                tinhtongtien();
            }
        }

        fillPhieuGiamKhongTaiKhoan();
        // document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("xoaPhieuGiam").addEventListener("click", function (event) {
            event.preventDefault();
            document.getElementById("fillMaGiam").style.display = "none";
            document.getElementById("maCodeGiam").innerText = "khong";
            document.getElementById("soTienGiam").innerText = "0 ₫";
            tinhtongtien();
        });
        // });
        document.getElementById("suDungPhieuGiam").addEventListener("click", async function (event) {
            event.preventDefault();
            const inputTamTinh = document.getElementById('tamTinh');
            // Lấy nội dung văn bản của phần tử
            const inputTamTinhValue = inputTamTinh.innerText || inputTamTinh.textContent;
            // Sử dụng regex để loại bỏ ký tự không phải là số và dấu phẩy
            const numberString = inputTamTinhValue.replace(/[^\d]/g, '');
            // Chuyển chuỗi đã làm sạch thành số nguyên
            const inputTamTinhSoNguyen = parseInt(numberString, 10);

            const lstPGG = await getPhieuGiamKhongTaiKhoan();

            var maGiamGia = document.getElementById("magiamgia").value;
            var errorMaGiam = document.getElementById("errorMaGiam");
            var MangTienGiam = [];
            lstPGG.forEach(p => {
                if (p.macode === maGiamGia.trim()) {
                    if (p.dontoithieu === null || p.dontoithieu <= inputTamTinhSoNguyen) {
                        if (p.loaiphieu != null && p.loaiphieu === true) {
                            const sotiengiam = ((p.giatrigiam / 100) * inputTamTinhSoNguyen);
                            if (p.giatrigiamtoida <= sotiengiam) {
                                var newObj = {
                                    code: p.macode,
                                    value: p.giatrigiamtoida
                                };
                                MangTienGiam.push(newObj);
                            } else {
                                var newObj = {
                                    code: p.macode,
                                    value: sotiengiam
                                };
                                MangTienGiam.push(newObj);
                            }

                        }
                        if (p.loaiphieu != null && p.loaiphieu === false) {
                            var newObj = {
                                code: p.macode,
                                value: p.giatrigiam
                            };
                            MangTienGiam.push(newObj);

                        }
                    }
                }
            })
            if (MangTienGiam.length > 0) {
                var max = MangTienGiam[0];
                document.getElementById("magiamgia").style.border = "";
                errorMaGiam.innerText = "";
                document.getElementById("fillMaGiam").style.display = "block";
                document.getElementById("maCodeGiam").innerText = max.code;
                document.getElementById("soTienGiam").innerText = "-" + formatCurrencyVND(max.value);
                tinhtongtien();
            }
            if (MangTienGiam.length <= 0) {
                errorMaGiam.innerText = "Mã khuyến mại không khả dụng!";
                document.getElementById("magiamgia").style.border = "2px solid red";
            }
        });

        async function getPhieu(Id) {
            const response = await fetch(`/lay-phieu-giam-theo-id/${Id}`);
            return await response.json();
        }

        $(document).ready(function () {
            // Bắt sự kiện click trên nút "Áp dụng"
            $(".apDungMaGiam").click(async function (event) {
                event.preventDefault();
                const inputTamTinh = document.getElementById('tamTinh');
                // Lấy nội dung văn bản của phần tử
                const inputTamTinhValue = inputTamTinh.innerText || inputTamTinh.textContent;
                // Sử dụng regex để loại bỏ ký tự không phải là số và dấu phẩy
                const numberString = inputTamTinhValue.replace(/[^\d]/g, '');
                // Chuyển chuỗi đã làm sạch thành số nguyên
                const inputTamTinhSoNguyen = parseInt(numberString, 10);

                var errorMaGiam = document.getElementById("errorMaGiam");
                var MangTienGiam = [];
                // Lấy ID của phiếu giảm giá từ thuộc tính data-id
                var idPhieu = $(this).data("id");
                const p = await getPhieu(idPhieu);
                // document.getElementById("staticBackdrop").style.display="none";
                if (p.dontoithieu === null || p.dontoithieu <= inputTamTinhSoNguyen) {
                    if (p.loaiphieu != null && p.loaiphieu === true) {
                        const sotiengiam = ((p.giatrigiam / 100) * inputTamTinhSoNguyen);
                        if (p.giatrigiamtoida <= sotiengiam) {
                            var newObj = {
                                code: p.macode,
                                value: p.giatrigiamtoida
                            };
                            MangTienGiam.push(newObj);
                        } else {
                            var newObj = {
                                code: p.macode,
                                value: sotiengiam
                            };
                            MangTienGiam.push(newObj);
                        }

                    }
                    if (p.loaiphieu != null && p.loaiphieu === false) {
                        var newObj = {
                            code: p.macode,
                            value: p.giatrigiam
                        };
                        MangTienGiam.push(newObj);
                    }
                }
                if (MangTienGiam.length > 0) {
                    var max = MangTienGiam[0];
                    document.getElementById("magiamgia").value = p.macode;
                    document.getElementById("magiamgia").style.border = "";
                    errorMaGiam.innerText = "";
                    document.getElementById("fillMaGiam").style.display = "block";
                    document.getElementById("maCodeGiam").innerText = max.code;
                    document.getElementById("soTienGiam").innerText = "-" + formatCurrencyVND(max.value);
                    tinhtongtien();
                }
                if (MangTienGiam.length <= 0) {
                    document.getElementById("magiamgia").value = p.macode;
                    errorMaGiam.innerText = "Mã khuyến mại không khả dụng!";
                    document.getElementById("magiamgia").style.border = "2px solid red";
                }
            });
        });

        function chuyendoitien(tien) {
            const inputTamTinh = tien;
            // Lấy nội dung văn bản của phần tử
            const inputTamTinhValue = inputTamTinh.innerText || inputTamTinh.textContent;
            // Sử dụng regex để loại bỏ ký tự không phải là số và dấu phẩy
            const numberString = inputTamTinhValue.replace(/[^\d]/g, '');
            // Chuyển chuỗi đã làm sạch thành số nguyên
            return parseInt(numberString, 10);
        }

        function layGiaTri() {
            var maCode = document.getElementById('maCodeGiam').innerText;
            var phi = document.getElementById('phivanchuyen').innerText;
            var tong = document.getElementById('tongtien').innerText;
            var ngay = document.getElementById('ngaygiaodukiens').innerText;
            var tamTinh = document.getElementById('tamTinh').innerText;
            var soTienGiam = document.getElementById('soTienGiam').innerText;


            // Đưa nội dung vào input hidden

            document.getElementById('maCodeGiam1').value = maCode;
            document.getElementById('phivanchuyen1').value = phi;
            document.getElementById('tongtien1').value = tong;
            document.getElementById('ngaygiaodukiens1').value = ngay;
            document.getElementById('tamtinh1').value = tamTinh;
            document.getElementById('sotiengiam1').value = soTienGiam;

        }

        function layDiaChi() {
            var inputTen = document.getElementById("hovaten").value;
            var inputEmail = document.getElementById("email").value;
            var inputSDT = document.getElementById("sdt").value;
            var inputDiaChi = document.getElementById("diachi").value;
            var inputTinh = document.getElementById("tinh").value;
            var inputHuyen = document.getElementById("huyen").value;
            var inputXa = document.getElementById("xa").value;

            document.getElementById('hotennhan').value = inputTen;
            document.getElementById('emailnhan').value = inputEmail;
            document.getElementById('sdtnhan').value = inputSDT;
            document.getElementById('diachinhan').value = inputDiaChi;
            document.getElementById('tinhnhan').value = inputTinh;
            document.getElementById('huyennhan').value = inputHuyen;
            document.getElementById('xanhan').value = inputXa;

            document.getElementById('hotennhanVNPay').value = inputTen;
            document.getElementById('emailnhanVNPay').value = inputEmail;
            document.getElementById('sdtnhanVNPay').value = inputSDT;
            document.getElementById('diachinhanVNPay').value = inputDiaChi;
            document.getElementById('tinhnhanVNPay').value = inputTinh;
            document.getElementById('huyennhanVNPay').value = inputHuyen;
            document.getElementById('xanhanVNPay').value = inputXa;

            document.getElementById('orderInfo').value = inputTen;
        }


    async function getDiaChiNhanHang(Id) {
        const response = await fetch(`/dia-chi-nhan-hang/${Id}`);
        return await response.json();
    }
    // Hàm hiển thị địa chỉ đã chọn
    async function HienDiaChiDaChon() {
        var select = document.getElementById("diachidaluu");
        var selectedOption = select.options[select.selectedIndex];
        var value = selectedOption.value;

        if (value === "-1") {
            document.getElementById("hovaten2").value = "";
            document.getElementById("sdt2").value = "";
            document.getElementById("diachi2").value = "";
            document.getElementById("tinh2").selectedIndex = 0;
            document.getElementById("huyen2").selectedIndex = 0;
            document.getElementById("xa2").selectedIndex = 0;
        } else {
            const dc = await getDiaChiNhanHang(value);

            document.getElementById("hovaten2").value = dc.hotennguoinhan;
            document.getElementById("sdt2").value = dc.sdtnguoinhan;
            document.getElementById("diachi2").value = dc.tenduong;

            var Parameter3 = {
                url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
                method: "GET",
                responseType: "application/json",
            };

            var tinh = dc.tinhthanhpho;
            var huyen = dc.quanhuyen;
            var xa = dc.xaphuong;
            var dataCities1 = [];
            var tinh3 = document.getElementById("tinh2");
            var huyen3 = document.getElementById("huyen2");
            var xa3 = document.getElementById("xa2");

            axios(Parameter3).then(function (result) {
                dataCities1 = result.data;
                console.log(dataCities1);
                renderCity3(dataCities1);
            });

            function renderCity3(data) {
                // Clear existing options
                tinh3.length = 1;
                huyen3.length = 1;
                xa3.length = 1;

                // Populate tinh3 options
                document.getElementById("tinh2").options[0].selected = false;
                for (const x of data) {

                    var opt = document.createElement('option');
                    opt.value = x.Name;
                    opt.text = x.Name;
                    opt.setAttribute('data-id', x.Id);
                    console.log(`Selecting tinh: ${x.Name}`);
                    if (x.Name === tinh) {
                        console.log(`Selecting tinh: ${x.Name}`);  // Debugging
                        opt.selected = true;
                    }
                    tinh3.options.add(opt);
                }
                // Add event listeners
                tinh3.addEventListener('change', function() {
                    renderHuyen3(data);
                });
                huyen3.addEventListener('change', function() {
                    renderXa3(data);
                });

                // Initial render of huyen3 and xa3
                renderHuyen3(data);
                renderXa3(data);
            }

            function renderHuyen3(data) {
                // Clear existing options
                huyen3.length = 1;
                xa3.length = 1;

                const selectedTinhId = tinh3.options[tinh3.selectedIndex].dataset.id;
                if (selectedTinhId) {
                    const selectedTinh = data.find(n => n.Id === selectedTinhId);
                    for (const k of selectedTinh.Districts) {
                        var opt = document.createElement('option');
                        opt.value = k.Name;
                        opt.text = k.Name;
                        opt.setAttribute('data-id', k.Id);
                        if (k.Name == huyen) {
                            opt.selected = true;
                        }
                        huyen3.options.add(opt);
                    }
                }

                renderXa3(data);
            }

            function renderXa3(data) {
                // Clear existing options
                xa3.length = 1;

                const selectedTinhId = tinh3.options[tinh3.selectedIndex].dataset.id;
                const selectedHuyenId = huyen3.options[huyen3.selectedIndex].dataset.id;

                if (selectedTinhId && selectedHuyenId) {
                    const selectedTinh = data.find(n => n.Id === selectedTinhId);
                    const selectedHuyen = selectedTinh.Districts.find(n => n.Id === selectedHuyenId);

                    for (const w of selectedHuyen.Wards) {
                        var opt = document.createElement('option');
                        opt.value = w.Name;
                        opt.text = w.Name;
                        opt.setAttribute('data-id', w.Id);
                        if (w.Name == xa) {
                            opt.selected = true;
                        }
                        xa3.options.add(opt);
                    }
                }
            }
        }
    }
    async function getDiaChiMacDinh() {
        const response = await fetch(`/dia-chi-mac-dinh`);
        return await response.json();
    }
    async function diaChiMacDinh(){
        const dc = await getDiaChiMacDinh();

        document.getElementById("hovaten2").value = dc.hotennguoinhan;
        document.getElementById("sdt2").value = dc.sdtnguoinhan;
        document.getElementById("diachi2").value = dc.tenduong;

        var Parameter3 = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };

        var tinh = dc.tinhthanhpho;
        var huyen = dc.quanhuyen;
        var xa = dc.xaphuong;
        var dataCities1 = [];
        var tinh3 = document.getElementById("tinh2");
        var huyen3 = document.getElementById("huyen2");
        var xa3 = document.getElementById("xa2");

        axios(Parameter3).then(function (result) {
            dataCities1 = result.data;
            console.log(dataCities1);
            renderCity3(dataCities1);
        });

        function renderCity3(data) {
            // Clear existing options
            tinh3.length = 1;
            huyen3.length = 1;
            xa3.length = 1;

            // Populate tinh3 options
            document.getElementById("tinh2").options[0].selected = false;
            for (const x of data) {

                var opt = document.createElement('option');
                opt.value = x.Name;
                opt.text = x.Name;
                opt.setAttribute('data-id', x.Id);
                console.log(`Selecting tinh: ${x.Name}`);
                if (x.Name === tinh) {
                    console.log(`Selecting tinh: ${x.Name}`);  // Debugging
                    opt.selected = true;
                }
                tinh3.options.add(opt);
            }
            // Add event listeners
            tinh3.addEventListener('change', function() {
                renderHuyen3(data);
            });
            huyen3.addEventListener('change', function() {
                renderXa3(data);
            });

            // Initial render of huyen3 and xa3
            renderHuyen3(data);
            renderXa3(data);
        }

        function renderHuyen3(data) {
            // Clear existing options
            huyen3.length = 1;
            xa3.length = 1;

            const selectedTinhId = tinh3.options[tinh3.selectedIndex].dataset.id;
            if (selectedTinhId) {
                const selectedTinh = data.find(n => n.Id === selectedTinhId);
                for (const k of selectedTinh.Districts) {
                    var opt = document.createElement('option');
                    opt.value = k.Name;
                    opt.text = k.Name;
                    opt.setAttribute('data-id', k.Id);
                    if (k.Name == huyen) {
                        opt.selected = true;
                    }
                    huyen3.options.add(opt);
                }
            }

            renderXa3(data);
        }

        function renderXa3(data) {
            // Clear existing options
            xa3.length = 1;

            const selectedTinhId = tinh3.options[tinh3.selectedIndex].dataset.id;
            const selectedHuyenId = huyen3.options[huyen3.selectedIndex].dataset.id;

            if (selectedTinhId && selectedHuyenId) {
                const selectedTinh = data.find(n => n.Id === selectedTinhId);
                const selectedHuyen = selectedTinh.Districts.find(n => n.Id === selectedHuyenId);

                for (const w of selectedHuyen.Wards) {
                    var opt = document.createElement('option');
                    opt.value = w.Name;
                    opt.text = w.Name;
                    opt.setAttribute('data-id', w.Id);
                    if (w.Name == xa) {
                        opt.selected = true;
                    }
                    xa3.options.add(opt);
                }
            }
        }
    }
    diaChiMacDinh();

    function validateFormDiaChiKhachCotaiKhoan(event) {
        event.preventDefault();
        var inputTen = document.getElementById("hovaten2").value;
        var errorTen = document.getElementById("errorTen2");
        var isTenValid = true;
        if (inputTen.trim() === "") {
            errorTen.innerText = "Vui lòng nhập họ tên!";
            document.getElementById("hovaten2").style.border = "2px solid red";
            isTenValid = false;
        }
        if (inputTen.trim().length > 0) {
            if (checkNhieuKhoangTrang(inputTen)) {
                errorTen.innerText = "Giữa các từ không được nhiều hơn 1 khoảng trắng!";
                document.getElementById("hovaten2").style.border = "2px solid red";
                isTenValid = false;
            }
        }
        if (inputTen.trim().length > 0) {
            if (validateTen(inputTen.trim()) === false) {
                errorTen.innerText = "Họ tên chỉ chứa ký tự và tối đa 30 ký tự!";
                document.getElementById("hovaten2").style.border = "2px solid red";
                isTenValid = false;
            }
        }
        if (isTenValid) {
            document.getElementById("hovaten2").style.border = "";
            errorTen.innerText = "";
        }
        // var inputEmail = document.getElementById("email").value;
        // var errorEmail = document.getElementById("errorEmail");
        // var isEmailValid = true;
        // if (inputEmail.trim() === "") {
        //     errorEmail.innerText = "Địa chỉ email không được trống!";
        //     document.getElementById("email").style.border = "2px solid red";
        //     isEmailValid = false;
        // }
        // if(inputEmail.trim().length > 0){
        //     if(checkCoKhoangTrang(inputEmail)){
        //         errorEmail.innerText = "Giữa các từ không được nhiều hơn 1 khoảng trắng!";
        //         document.getElementById("email").style.border="2px solid red";
        //         isEmailValid = false;
        //     }
        // }
        // if (inputEmail.trim().length > 0) {
        //     if (validateEmail(inputEmail.trim()) === false) {
        //         errorEmail.innerText = "Địa chỉ email sai định dạng!";
        //         document.getElementById("email").style.border = "2px solid red";
        //         isEmailValid = false;
        //     }
        // }
        // if (isEmailValid) {
        //     document.getElementById("email").style.border = "";
        //     errorEmail.innerText = "";
        // }
        var inputSDT = document.getElementById("sdt2").value;
        var errorSDT = document.getElementById("errorSDT2");
        var isSDTValid = true;

        if (inputSDT.trim() === "") {
            errorSDT.innerText = "Số điện thoại không được trống!";
            document.getElementById("sdt2").style.border = "2px solid red";
            isSDTValid = false;
        }

        if (inputSDT.trim().length > 0) {
            if (validatePhoneNumber(inputSDT.trim()) === false) {
                errorSDT.innerText = "Số điện thoại sai định dạng!";
                document.getElementById("sdt2").style.border = "2px solid red";
                isSDTValid = false;
            }
        }
        if (isSDTValid) {
            document.getElementById("sdt2").style.border = "";
            errorSDT.innerText = "";
        }

        var inputDiaChi = document.getElementById("diachi2").value;
        var errorDiaChi = document.getElementById("errorDiaChi2");
        var isDiaChiValid = true;

        if (inputDiaChi.trim() === "") {
            errorDiaChi.innerText = "Địa chỉ không được trống!";
            document.getElementById("diachi2").style.border = "2px solid red";
            isDiaChiValid = false;
        }

        if (inputDiaChi.trim().length > 0) {
            if (checkNhieuKhoangTrang(inputDiaChi)) {
                errorDiaChi.innerText = "Giữa các từ không được nhiều hơn 1 khoảng trắng!";
                document.getElementById("diachi2").style.border = "2px solid red";
                isDiaChiValid = false;
            }
        }
        if (inputDiaChi.trim().length > 0) {
            if (inputDiaChi.trim().length > 50) {
                errorDiaChi.innerText = "Địa chỉ tối ta 50 ký tự!";
                document.getElementById("diachi2").style.border = "2px solid red";
                isDiaChiValid = false;
            }
        }
        if (isDiaChiValid) {
            document.getElementById("diachi2").style.border = "";
            errorDiaChi.innerText = "";
        }

        var inputTinh = document.getElementById("tinh2");
        var errorTinh = document.getElementById("errorTinh2");
        var isTinhValid = true;

        if (inputTinh.options[0].selected) {
            errorTinh.innerText = "Vui lòng chọn tỉnh thành!";
            document.getElementById("tinh2").style.border = "2px solid red";
            isTinhValid = false;
        }
        if (isTinhValid) {
            document.getElementById("tinh2").style.border = "";
            errorTinh.innerText = "";
        }

        var inputHuyen = document.getElementById("huyen2");
        var errorHuyen = document.getElementById("errorHuyen2");
        var isHuyenValid = true;

        if (inputHuyen.options[0].selected) {
            errorHuyen.innerText = "Vui lòng chọn quận huyện!";
            document.getElementById("huyen2").style.border = "2px solid red";
            isHuyenValid = false;
        }
        if (isHuyenValid) {
            document.getElementById("huyen2").style.border = "";
            errorHuyen.innerText = "";
        }

        var inputXa = document.getElementById("xa2");
        var errorXa = document.getElementById("errorXa2");
        var isXaValid = true;

        if (inputXa.options[0].selected) {
            errorXa.innerText = "Vui lòng chọn phường xã!";
            document.getElementById("xa2").style.border = "2px solid red";
            isXaValid = false;
        }
        if (isXaValid) {
            document.getElementById("xa2").style.border = "";
            errorXa.innerText = "";
        }

        if (isTenValid && isSDTValid && isDiaChiValid && isTinhValid && isHuyenValid && isXaValid) {
            console.log("da vao");
            document.getElementById("left1").style.display = "none";
            document.getElementById("left2").style.display = "none";
            document.getElementById("left3").style.display = "block";
            var tinh = document.getElementById("tinh2").value;
            console.log(tinh);
            var huyen = document.getElementById("huyen2").value;
            console.log(huyen);
            var xa = document.getElementById("xa2").value;
            console.log(xa);
            callIdCity(tinh, huyen, xa);
            return true;
        } else {
            return false;
        }
    }
    function layDiaChi2() {
        var inputTen = document.getElementById("hovaten2").value;
        var inputSDT = document.getElementById("sdt2").value;
        var inputDiaChi = document.getElementById("diachi2").value;
        var inputTinh = document.getElementById("tinh2").value;
        var inputHuyen = document.getElementById("huyen2").value;
        var inputXa = document.getElementById("xa2").value;

        document.getElementById('hotennhan').value = inputTen;
        document.getElementById('emailnhan').value = "";
        document.getElementById('sdtnhan').value = inputSDT;
        document.getElementById('diachinhan').value = inputDiaChi;
        document.getElementById('tinhnhan').value = inputTinh;
        document.getElementById('huyennhan').value = inputHuyen;
        document.getElementById('xanhan').value = inputXa;

        document.getElementById('hotennhanVNPay').value = inputTen;
        document.getElementById('emailnhanVNPay').value = "";
        document.getElementById('sdtnhanVNPay').value = inputSDT;
        document.getElementById('diachinhanVNPay').value = inputDiaChi;
        document.getElementById('tinhnhanVNPay').value = inputTinh;
        document.getElementById('huyennhanVNPay').value = inputHuyen;
        document.getElementById('xanhanVNPay').value = inputXa;

        document.getElementById('orderInfo').value = inputTen;
    }
    function formatCurrencyVND(number) {
        // Định dạng số theo tiền tệ Việt Nam
        let formattedNumber = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(number);

        // Thay dấu chấm bằng dấu phẩy
        formattedNumber = formattedNumber.replace(/\./g, ',');

        return formattedNumber;
    }
    async function DatHangOnlThatBai() {
        const response = await fetch('/dat-online-that-bai');
        const data = await response.json();
        console.log(data);
        if (data === 2) {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });

            Toast.fire({
                icon: "error",
                title: "Đã hủy thanh toán!"
            }).then(async () => {
                // Xóa session sau khi hiển thị thông báo
                await fetch('/clear-session-thanh-toan-online', { method: 'POST' });
            });
        }
    }
    DatHangOnlThatBai();
</script>
</body>
</html>