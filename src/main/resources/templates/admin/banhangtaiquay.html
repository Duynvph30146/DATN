<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<nav th:replace="~{/layoutadmin/head.html}"></nav>
<style>
    .checkbox-red:checked {
        background-color: red;
    }

    /* CSS cho tab */
    .tab {
        display: none;
        /* Ẩn tất cả các tab khi ban đầu */
    }

    /* Định dạng các tab */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        position: relative;
        /* Đặt vị trí của nút xóa */
    }

    /* Tạo nội dung của mỗi tab */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
    }

    /* Biểu tượng xóa */
    .close {
        position: absolute;
        top: 0;
        right: 0;
        color: red;
        /* Màu của biểu tượng xóa */
        font-size: 20px;
        cursor: pointer;
        display: none;
        /* Ẩn ban đầu */
    }

    /* Hiển thị biểu tượng xóa khi rê chuột vào tab */
    .tab button:hover .close {
        display: block;
    }

    /* CSS cho tab được chọn */
    .tab button.active {
        border-bottom: 2px solid red;
        /* Đường viền dưới màu đỏ cho tab khi được chọn */
    }
</style>
<script src="../sweetalert2/dist/sweetalert2.min.js/"></script>
<link rel="stylesheet" type="text/css" href="../sweetalert2/dist/sweetalert2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<body class="hold-transition sidebar-mini" style="font-family: 'Bahnschrift'">

    <div class="wrapper">
        <!-- Navbar -->
        <nav th:replace="~{/layoutadmin/navbar.html}"></nav>
        <!-- End navbar -->

        <!--Menu bán hàng -->
        <nav th:replace="~{/layoutadmin/menu.html}"></nav>
        <!--end-->


        <!--Nội dung2 -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                                    class="bi bi-bookmark-dash-fill" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5M6 6a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1z" />
                                </svg>
                                BÁN HÀNG TẠI QUẦY
                            </h1>
                            <div id="dataContainer" th:data-my-attribute="${check}" style="display:none;"></div>
                        </div>
                        <!--                    <div class="col-sm-6">-->
                        <!--                        <ol class="breadcrumb float-sm-right">-->
                        <!--                            <li class="breadcrumb-item"><a href="#">Home</a></li>-->
                        <!--                            <li class="breadcrumb-item active">BÁN HÀNG TẠI QUẦY</li>-->
                        <!--                        </ol>-->
                        <!--                    </div>-->
                    </div>
                </div><!-- /.container-fluid -->
            </section>
            <!-- Nút để tạo hóa đơn -->
            <button class="btn" style="margin-left: 1100px;background-color: rgb(249,72,42);color: white"
                onclick="taoNewHD()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus"
                    viewBox="0 0 16 16">
                    <path
                        d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                </svg>
                Tạo hóa đơn
            </button>
            <p></p>
            <!-- Container cho các tab -->
            <div class="tab" id="tabContainer">
                <!-- Các tab sẽ được tạo ra bởi JavaScript -->
            </div>
            <div class="d-flex">
                <h5 style="margin-left: 25px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-bucket" viewBox="0 0 16 16">
                        <path
                            d="M2.522 5H2a.5.5 0 0 0-.494.574l1.372 9.149A1.5 1.5 0 0 0 4.36 16h7.278a1.5 1.5 0 0 0 1.483-1.277l1.373-9.149A.5.5 0 0 0 14 5h-.522A5.5 5.5 0 0 0 2.522 5m1.005 0a4.5 4.5 0 0 1 8.945 0zm9.892 1-1.286 8.574a.5.5 0 0 1-.494.426H4.36a.5.5 0 0 1-.494-.426L2.58 6h10.838z" />
                    </svg>
                    Sản phẩm
                </h5>
                <a class="btn btn-dark" style="margin-left: 710px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                        <path
                            d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z" />
                        <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z" />
                        <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z" />
                        <path
                            d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z" />
                        <path d="M12 9h2V8h-2z" />
                    </svg>
                    Quét QR Sản phẩm
                </a>
                <button class="btn" style="margin-left: 20px;background-color: rgb(249,72,42);color: white"
                    data-bs-toggle="modal" data-bs-target="#modalThemSanPhamHD" id="changeSP">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-plus" viewBox="0 0 16 16">
                        <path
                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                    </svg>
                    Thêm sản phẩm
                </button>
            </div>
            <hr <!-- Nội dung của các tab -->
            <div id="GhiDeTab">
                <div class="tab-pane fade show active text-center fw-bold" id="tatCaHoaDon-tab-pane" role="tabpanel"
                    aria-labelledby="tatCaHoaDon-tab" tabindex="0">
                    <br>
                    <img src="../dist/img/no_product.png" width="500px" height="300px">
                    <h3 class="text text-danger"><i>Chưa có hóa đơn nào được tạo!! <i class="bi bi-emoji-tear"></i>!</i>
                    </h3>
                </div>`;
            </div>
            <!-- các modal -->

            <!--         
    thay đổi thông tin hóa đơn -->
            <div class="modal fade" id="modalThayDoiHoaDon5" tabindex="-1" aria-labelledby="exampleModalThayDoiHoaDon5"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title fs-5" id="exampleModalThayDoiHoaDon5">Thanh toán hóa đơn: <span
                                    id="hdThanhToanShow"></span></h3>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                            <div>
                                Số tiền
                                <input type="text" class="form-control" id="sotienhienthi"
                                    oninput="showcasst('sotienhienthi')">
                            </div>
                            <br>
                            <div class="d-flex">
                                <button class="btn" style="width: 217px;background-color: rgb(249,72,42);color: white"
                                    id="tienmat" onclick="xacnhanphuongthuc(1)">Tiền
                                    mặt</button>
                                <button
                                    style="margin-left: 15px;width: 217px;background-color: rgb(249,72,42);color: white"
                                    id="chuyenkhoan" class="btn" onclick="xacnhanphuongthuc(0)">Chuyển
                                    khoản</button>
                            </div>
                            <br>
                            <table style="width: 100%" class="table-bordered table-hover text-center">
                                <thead style="height: 50px">
                                    <tr>
                                        <th>STT</th>
                                        <th>Mã giao dịch</th>
                                        <th>Số tiền</th>
                                        <th>Phương thức</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="showpt">

                                </tbody>
                            </table>
                            <br>
                            <div class="d-flex justify-content-between">
                                <p>
                                    Khách thanh toán
                                </p>
                                <p style="color: #0a53be;font-weight: bold" id="dathanhtoanroi">
                                    0đ
                                </p>
                            </div>
                            <div class="d-flex justify-content-between">
                                <p>
                                    Tiền thiếu
                                </p>
                                <p style="color: red;font-weight: bold" id="tienthieu">
                                    5,500,000đ
                                </p>
                            </div>


                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Hủy</button>
                            <button type="button" class="btn" style="background-color: rgb(249,72,42);color: white"
                                data-bs-dismiss="modal" id="xacnhanPT" onclick="xacnhanPTTT()">Xác nhận</button>

                        </div>
                    </div>
                </div>
            </div>

            <!--Modal thay đổi nhân viên-->
            <!-- Modal -->
            <div class="modal fade" id="modalChuyenNhanVien" tabindex="-1" aria-labelledby="exampleModalChuyenNhanVien"
                aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title fs-5" id="exampleModalChuyenNhanVien">Chọn khách hàng
                            </h3>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <button type="button" class="btn" data-bs-toggle="modal"
                                            data-bs-target="#exampleModal"
                                            style="background-color: rgb(249,72,42);color: white">+Thêm khách
                                            hàng</button>
                                    </div>
                                    <nav class="navbar bg-body-tertiary">
                                        <div class="container-fluid">
                                            <form class="d-flex" role="search">
                                                <input style="width: 400px;" class="form-control me-2" type="search"
                                                    placeholder="Nhập họ tên hoặc số điện thoại..." aria-label="Search"
                                                    id="searchNV">
                                                <button type="button" id="reloadnv" class="btn btn-outline-warning"><i
                                                        class="bi bi-arrow-clockwise"></i></button>
                                            </form>
                                        </div>
                                    </nav>
                                </div>


                                <table class="table table-bordered table-hover text-center">
                                    <thead class="table table-danger">
                                        <tr>
                                            <th>STT</th>
                                            <th>Mã khách hàng</th>
                                            <th>Tên khách hàng</th>
                                            <th>Số điện thoại</th>
                                            <th>Ngày sinh</th>
                                            <th>Giới tính</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbl_doi_nv">

                                    </tbody>
                                </table>
                                <br>

                                <nav aria-label="Page navigation example" id="navNV">
                                    <ul class="pagination">
                                        <li class="page-item" id="btn_prev_page"><a class="page-link"
                                                id="prevPage">Previous</a>
                                        </li>
                                        <li class="d-flex flex-row page-item" id="numberPage">
                                        </li>
                                        <li class="page-item" id="btn_next_page">
                                            <a class="page-link" id="nextPage">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Kết thúc modal thay đổi nhân viên-->

            <!-- thêm sản phẩm vào hóa đơn -->

            <!--Modal thêm sản phẩm vào hóa đơn-->
            <!-- Modal -->
            <div class="modal fade" id="modalThemSanPhamHD" tabindex="-1" aria-labelledby="exampleModalThemSanPhamHD"
                aria-hidden="true">
                <div class="modal-dialog modal-xl modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title fs-5" id="exampleModalThemSanPhamHD">Thêm
                                sản phẩm vào đơn hàng</h3>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <nav class="navbar bg-body-tertiary">
                                        <form>
                                            <div class="d-flex align-items-center">
                                                <input class="form-control me-2" type="search" id="tensp"
                                                    placeholder="Nhập tên sản phẩm..." aria-label="Search"
                                                    style="width: 984px;">
                                                <button type="button" id="reloadsp" class="btn btn-outline-warning"><i
                                                        class="bi bi-arrow-clockwise"></i></button>
                                            </div>
                                            <!--Bộ lọc-->
                                            <div class="align-items-center">
                                                <div class="d-flex justify-content-around">
                                                    <div>
                                                        <label class="col-form-label">Chất
                                                            liệu</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="chatlieu" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsChatLieu}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="col-form-label">Thương
                                                            hiệu</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="thuonghieu" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsThuongHieu}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="col-form-label">Đế
                                                            giày</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="degiay" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsDe}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="col-form-label">Kích
                                                            cỡ</label>
                                                        <select class="form-select" onchange="SearchSPHDCT()"
                                                            id="kichco" style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsKichCo}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label class="col-form-label">Màu
                                                            sắc</label>
                                                        <select class="form-select" oninput="SearchSPHDCT()" id="mausac"
                                                            style="width: 120px;">
                                                            <option value="all" selected>
                                                                ----</option>
                                                            <option th:each="a:${dsMauSac}" th:value="${a.ten}"
                                                                th:text="${a.ten}">

                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="d-flex justify-content-evenly">
                                                <div>
                                                    <label class="col-form-label">Giới
                                                        tính</label>
                                                    <select class="form-select" onchange="SearchSPHDCT()" id="gioitinh"
                                                        style="width: 120px;">

                                                        <option value="true">Nam</option>
                                                        <option value="false">Nữ</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="col-form-label">Khoảng
                                                        giá: <span id="priceRangeValue">500,000 đ
                                                        </span></label>

                                                    <div class="slidecontainer mt-1" style="width: 495px;">
                                                        <input type="range" min="100000" onchange="SearchSPHDCT()"
                                                            max="8000000" value="500000" style="width: 100%;"
                                                            id="priceRange">
                                                    </div>


                                                </div>
                                            </div>
                                        </form>
                                    </nav>
                                </div>
                                <br>
                                <table class="table table-bordered table-hover text-center">
                                    <thead class="table table-danger">
                                        <tr>
                                            <th>STT</th>
                                            <th>Ảnh sản phẩm</th>
                                            <th>Tên sản phẩm</th>
                                            <th>Số lượng</th>
                                            <th>Kích cỡ</th>
                                            <th>Màu sắc</th>
                                            <th>Trạng thái</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbl_sp_them">

                                    </tbody>
                                </table>
                                <br>
                                <nav aria-label="Page navigation example" id="navAddSPHDCT">
                                    <ul class="pagination">
                                        <li class="page-item" id="btn_prev_page"><a class="page-link"
                                                id="prevPageSP">Previous</a>
                                        </li>
                                        <li class="d-flex flex-row page-item" id="numberPageSP">


                                        </li>
                                        <li class="page-item" id="btn_next_page">
                                            <a class="page-link" id="nextPageSP">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Kết thúc Modal thêm sản phẩm vào hóa đơn-->
            <!-- thêm khách hàng -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Thêm nhanh khách hàng</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                            <form th:action="@{http://localhost:8080/ban-hang-tai-quay/add-nhanh}"
                                th:object="${AddKHNhanh}" method="post">
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập họ và tên"
                                        th:field="*{ten}">
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập số điện thoại"
                                        th:field="*{sdt}">
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập email"
                                        th:field="*{email}">
                                </p>
                                <p class="d-flex">
                                    <select class="form-select form-select-sm mb-3" id="city" th:field="*{tinh}">
                                        <option value="" th:text="*{tinh}" selected>
                                            Chọn tỉnh thành</option>
                                    </select>
                                    <select class="form-select form-select-sm mb-3" id="district" th:field="*{huyen}">
                                        <option value="" th:text="*{huyen}" selected>Chọn quận huyện</option>
                                    </select>
                                    <select class="form-select form-select-sm mb-3" id="ward" th:field="*{xa}">
                                        <option value="" th:text="*{xa}" selected>
                                            Chọn phường xã</option>
                                    </select>
                                </p>
                                <p>
                                    <textarea class="form-control" placeholder="Số nhà/đường"
                                        th:field="*{diachi}"></textarea>
                                </p>
                                <div class="d-flex justify-content-start">
                                    <p class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" checked
                                            id="inputThemNhanh" onclick="seton()" th:field="*{check}">
                                    </p>
                                    <div class="ms-3" id="showndcheck">

                                        <p style="font-style: italic;">Thêm nhanh và lựa chọn khách hàng cho hóa đơn!
                                        </p>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="submit" class="btn"
                                        style="background-color: rgb(249,72,42);color: white">Thêm nhanh</button>
                                </div>
                            </form>

                        </div>

                    </div>
                </div>
            </div>
            <!--</div>-->
            <!--end-->
            <div>
                <hr>
                <div class="d-flex">
                    <h5 style="margin-left: 820px">Tổng tiền:</h5>
                    <h5 style="margin-left: 25px;color: red" id="tongTien">0 đ</h5>
                </div>
                <br>
                <div class="d-flex pe-1 ps-1">
                    <h5 class="me-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-person" viewBox="0 0 16 16">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z" />
                        </svg>
                        Tài khoản
                    </h5>
                    <button class="btn ms-auto" style="background-color: rgb(249,72,42);color: white"
                        data-bs-toggle="modal" data-bs-target="#modalChuyenNhanVien" id="changeNV">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-plus" viewBox="0 0 16 16">
                            <path
                                d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                        </svg>
                        Chọn tài khoản
                    </button>
                </div>
                <hr>
                <div id="thongTinTaiKhoan">

                </div>
                <br>
                <div class="d-flex justify-content-between pe-1 ps-1">
                    <h5>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-person" viewBox="0 0 16 16">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z" />
                        </svg>
                        Khách hàng
                    </h5>
                    <p></p>
                </div>
                <hr>
                <div class="row ps-2 pe-2">
                    <div class="col-7">
                        <div style="display: none;" id="diachidiv">
                            <form id="thongtingiaohangform" th:object="${thongtingiaohang}" method="post" action="">
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập họ và tên"
                                        id="thongtingiao_ten" th:field="*{ten}">
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập số điện thoại"
                                        id="thongtingiao_sdt" th:field="*{sdt}">
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập email"
                                        id="thongtingiao_email" th:field="*{email}">
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Nhập địa chỉ"
                                        id="thongtingiao_diachi" th:field="*{diachi}">
                                </p>
                                <p class="d-flex">
                                    <select class="form-select form-select-sm mb-3" id="tinhthanh" th:field="*{tinh}">
                                        <option value="chọn tỉnh" th:text="*{tinh}" selected>
                                            Chọn tỉnh thành</option>
                                    </select>
                                    <select class="form-select form-select-sm mb-3" id="quanhuyen" th:field="*{huyen}">
                                        <option value="" th:text="*{huyen}" selected>Chọn quận huyện</option>
                                    </select>
                                    <select class="form-select form-select-sm mb-3" id="xaphuong" th:field="*{xa}">
                                        <option value="" th:text="*{xa}" selected>
                                            Chọn phường xã</option>
                                    </select>
                                </p>
                                <p>
                                    <input type="text" class="form-control" placeholder="Phí vận chuyển"
                                        oninput="showcasst('phigiaohang')" id="phigiaohang" th:field="*{phivanchuyen}">
                                </p>
                                <p>
                                    <textarea class="form-control" placeholder="Ghi chú"
                                        th:field="*{ghichu}"></textarea>
                                </p>
                                <div class="d-flex justify-content-between ms-1">
                                    <p>Trả sau:</p>
                                    <p class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                            th:field="*{trasau}" onchange="handleCheckboxChange(event)">
                                    </p>
                                </div>

                            </form>
                        </div>
                    </div>
                    <div class="col-5">
                        <h5>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                class="bi bi-bucket" viewBox="0 0 16 16">
                                <path
                                    d="M2.522 5H2a.5.5 0 0 0-.494.574l1.372 9.149A1.5 1.5 0 0 0 4.36 16h7.278a1.5 1.5 0 0 0 1.483-1.277l1.373-9.149A.5.5 0 0 0 14 5h-.522A5.5 5.5 0 0 0 2.522 5m1.005 0a4.5 4.5 0 0 1 8.945 0zm9.892 1-1.286 8.574a.5.5 0 0 1-.494.426H4.36a.5.5 0 0 1-.494-.426L2.58 6h10.838z" />
                            </svg>
                            Thông tin thanh toán
                        </h5>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Khách thanh toán:
                                <button class="btn" data-bs-toggle="modal" data-bs-target="#modalThayDoiHoaDon5"
                                    id="chantrasau" onclick="thanhtoan()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-credit-card" viewBox="0 0 16 16">
                                        <path
                                            d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z" />
                                        <path
                                            d="M2 10a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z" />
                                    </svg>
                                </button>
                            </p>
                            <p></p>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <p style="font-weight: bold; margin-top: 10px;"> Mã giảm giá:</p>
                            <p style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white; padding-top: 10px;"
                                id="maGiamFill">Chưa có mã giảm phù hợp!</p>

                            <button class="btn btn-light" style="margin-bottom: 20px;">Chọn mã giảm</button>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Giao hàng:</p>
                            <p class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" onclick="giaohang(event)"
                                    id="checktrasau">
                            </p>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Tiền hàng:</p>
                            <p style="font-weight: bold" id="tongTienTTTT"></p>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Giảm giá:</p>
                            <p style="font-weight: bold" id="giamgia">0 đ</p>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <p style="font-weight: bold">Tổng thanh toán:</p>
                            <p style="color: red;font-weight: bold" id="tongThanhToan">0 đ</p>
                        </div>

                        <p>
                            <button style="margin-left: 332px" class="btn btn-dark" disabled id="xacnhanthanhtoanhoadon"
                                onclick="handleLinkClick()">Xác nhận thanh toán</button>
                        </p>

                    </div>

                </div>
            </div>
        </div>

    </div>

    <nav th:replace="~{/layoutadmin/footer.html}"></nav>
    <!--script-->
    <nav th:replace="~{/layoutadmin/script.html}"></nav>
    <!--nội dung 2-->


    <script>
        //tạo biến toàn cũng để sử dụng
        var tienkhachthanhtoan;
        var hdHienTai;
        // JavaScript để tạo tab mới
        const urlPage = `/ban-hang-tai-quay/hoa-don-cho`;
        fetch(urlPage)
            .then(function (a) {
                return a.json();
            })
            .then(function (b) {
                if (b.length > 0) {
                    var htmlDiv = '';
                    for (const hd of b) {
                        loadTab(hd.mahoadon);
                        htmlDiv += `
                        <div id="${hd.mahoadon}" class="tabcontent">

                        </div>`;
                    }
                    document.getElementById('GhiDeTab').innerHTML = htmlDiv;
                    openInvoice(event, b[0].mahoadon);
                } else {

                }

            })


        function loadTab(inputs) {

            var tabContainer = document.getElementById("tabContainer");
            tabContainer.style.display = "inline-block"; // Hiển thị các tab khi nhấn vào nút "Tạo Hóa đơn"

            var tabId = inputs;

            var button = document.createElement("button");
            button.className = "tablinks";
            button.textContent = "Hóa đơn: " + inputs;
            button.setAttribute("data-tab", tabId); // Thêm thuộc tính dữ liệu để liên kết tab với nội dung của nó
            button.setAttribute("onclick", "openInvoice(event, '" + tabId + "')");

            // Tạo biểu tượng xóa
            var closeIcon = document.createElement("span");
            closeIcon.innerHTML = "&times;"; // Thêm biểu tượng xóa (dấu x)
            closeIcon.className = "close";
            closeIcon.setAttribute("onclick", "closeTab('" + tabId + "')"); // Gọi hàm closeTab khi được nhấn

            button.appendChild(closeIcon); // Thêm biểu tượng xóa vào tab

            tabContainer.appendChild(button);
        }

        //tạo hóa đơn mới
        function taoNewHD() {
            var urlPage = `/ban-hang-tai-quay/hoa-don-cho`;
            fetch(urlPage)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    if (b.length == 5) {
                        showToast();
                    } else {
                        var urlTao = `/ban-hang-tai-quay/tao-don-cho`;
                        fetch(urlTao)
                            .then(function (a) {
                                return a.json();
                            })
                            .then(function (b) {

                                document.getElementById("tabContainer").innerHTML = '';
                                for (const hd of b) {

                                    loadTab(hd.mahoadon);

                                }


                            })

                    }
                })
        }



        // JavaScript để mở tab
        function openInvoice(evt, invoiceName) {

            document.getElementById('changeNV').disabled = false;
            document.getElementById('changeSP').disabled = false;
            document.getElementById('tienmat').disabled = false;
            document.getElementById('chuyenkhoan').disabled = false;
            document.getElementById('diachidiv').style.display = 'none';
            document.getElementById("checktrasau").checked = false;
            var i, tabcontent, tablinks;

            // Ẩn tất cả các tabcontent trước khi hiển thị tab được chọn
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Loại bỏ class "active" từ tất cả các tablinks
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active"); // Loại bỏ lớp "active" từ tất cả các tab
            }
        

            //tạo mã html cho hóa đơn được gọi
            const maHD = invoiceName;
            const urlGetListSP = `/ban-hang-tai-quay/tim-coutSP-theoHD?maHD=${maHD}`;
            fetch(urlGetListSP)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var tongTien = 0;
                    var tongThanhT = 0;
                    var tienGiamT = 0;
                    var html = '';
                    var htmlTR = '';
                    var htmlMaGiam = '';

                    var urltimHD = `/ban-hang-tai-quay/tim-HD-TheoMaHD?maHD=${invoiceName}`;
                    fetch(urltimHD)
                        .then(function (a) {
                            return a.json();
                        })
                        .then(function (b) {
                            var htmlTTTK = '';
                            if (b.khachhang == null) {
                                htmlTTTK = `
                            <div class="d-flex">
                        <p style="margin-left: 20px">Tên khách hàng:</p>
                        <p style="margin-left: 20px">Khách lẻ</p>
                    </div>
                            `;
                            } else {

                                htmlTTTK = `
                                <div class="d-flex">
                        <p style="margin-left: 20px">Tên khách hàng:</p>
                        <p style="margin-left: 20px">${b.khachhang.nguoidung.hovaten}</p>
                    </div>
                    <div class="d-flex">
                        <p style="margin-left: 20px">Số điện thoại:</p>
                        <p style="margin-left: 20px">${b.khachhang.nguoidung.sodienthoai}</p>
                    </div>
                    <div class="d-flex">
                        <p style="margin-left: 20px">Email:</p>
                        <p style="margin-left: 20px">${b.khachhang.nguoidung.email}</p>
                    </div>
                                `;
                            }

                            document.getElementById("thongTinTaiKhoan").innerHTML = htmlTTTK;
                        })


                    if (b.length < 1) {
                        html = `
<div class="tab-pane fade show active text-center fw-bold"
                                            id="tatCaHoaDon-tab-pane" role="tabpanel" aria-labelledby="tatCaHoaDon-tab"
                                            tabindex="0">
                                            <br>
                                            <img src="../dist/img/no_product.png" width="500px" height="300px">
                                            <h3 class="text text-danger"><i>Danh sách sản phẩm hiện đang trống!! <i
                                                        class="bi bi-emoji-tear"></i>!</i></h3>
                                        </div>`;
                    }
                    if (b.length > 0) {
                        var stt = 0;
                        for (const hd of b) {
                            tongTien += hd.soluong * hd.giasanpham;
                            stt++;
                            htmlTR += `
                            <tr>
            <td class="text-center" style="vertical-align: middle;">
                <span style="margin-left: 7px">${stt}</span>
            </td>
            <td style="vertical-align: middle;">
                <img src="${hd.sanphamchitiet.anh}" width="100px" height="100px" />
            </td>
            <td style="vertical-align: middle;">
                <p style="font-weight: bold">${hd.sanphamchitiet.sanpham.tensanpham}</p>
                <p style="color: red;font-weight: bold">${hd.giasanpham.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</p>
                <p> Size: ${hd.sanphamchitiet.kichco.ten}</p>
            </td>
            <td style="vertical-align: middle;">
                <input class="form-control" style="width: 120px;height: 30px; margin-left: 20%;" type="text" id="${hd.id}" value="${hd.soluong}" oninput="changeQuantity(event)">
            </td>
            <td style="color: red;font-weight: bold;vertical-align: middle;">${(hd.soluong * hd.giasanpham).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</td>
            <td style="vertical-align: middle;">
                                                           <a href="http://localhost:8080/ban-hang-tai-quay/delete/${hd.id}"
                                                            >
                                                            <button class="btn btn-outline-danger"
                                                                onclick="return confirm('Bạn có muốn xóa sản phẩm này không?')"
                                                                type="button"><i class="bi bi-trash3"></i></button></a>


                                                                <a href="http://localhost:8080/ban-hang-tai-quay/update/${hd.id}/${hd.soluong}" id="${hd.id + 'fsport'}"
                                                            >
                                                            <button class="btn btn-outline-warning"
                                                                onclick="return confirm('Bạn có muốn cập nhật lại sản phẩm này không?')"
                                                                type="button"><i
                                                                    class="bi bi-arrow-clockwise bi-warning"></i></button></a>
            </td>
        </tr>
                            `;
                        }

                        html = `
<div class="tab-pane fade show active text-center fw-bold"
id="tatCaHoaDon-tab-pane" role="tabpanel" aria-labelledby="tatCaHoaDon-tab"
tabindex="0">
<table style="width: 100%" class="table">
    <thead style="height: 50px">
        <tr>
            <th>STT</th>
            <th>Ảnh</th>
            <th>Sản phẩm</th>
            <th>Số lượng</th>
            <th>Tổng tiền</th>
            <th>Thao tác</th>
        </tr>
    </thead>
    <tbody>`+ htmlTR + `

    </tbody>
</table>
</div>`;
                    }

                    fetch(`http://localhost:8080/ban-hang-tai-quay/fillMaGiam`)
                        .then(function (a) {
                            return a.json();
                        })
                        .then(function (b) {
                            var b2 = b;
                            if (b.phieugiamgia.id != null) {
                                if (b2.phieugiamgia.loaiphieu == true) {
                                    // phiếu %
                                    if (b2.phieugiamgia.giatrigiam * (tongTien / 100) > b2.phieugiamgia.giatrigiamtoida) {
                                        tienGiamT = b2.phieugiamgia.giatrigiamtoida;
                                    } else {
                                        tienGiamT = b2.phieugiamgia.giatrigiam * (tongTien / 100);
                                    }

                                } else {
                                    // phiếu vnđ
                                    tienGiamT = b2.phieugiamgia.giatrigiam;
                                }
                                tongThanhT = tongTien - tienGiamT;
                                document.getElementById('maGiamFill').innerHTML = b.phieugiamgia.macode;
                            } else {
                                document.getElementById('maGiamFill').innerHTML = 'chưa có mã nào phù hợp!';
                                tongThanhT = tongTien;
                            }
                            tienkhachthanhtoan = tongThanhT;
                            hdHienTai = maHD;


                            document.getElementById('giamgia').innerHTML = tienGiamT.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tongThanhToan').innerHTML = tongThanhT.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });

                        })
                    document.getElementById('GhiDeTab').innerHTML = html;
                    evt.currentTarget.classList.add("active"); // Thêm lớp "active" cho tab được chọn
                    //document.getElementById(invoiceName).innerHTML = html;
                    document.getElementById("tongTien").innerHTML = tongTien.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                    document.getElementById("tongTienTTTT").innerHTML = tongTien.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                
                })


            // Hiển thị nội dung của tab được chọn và thêm class "active" cho tab đó

            document.getElementById(invoiceName).style.display = "block";

        }

        // JavaScript để đóng tab
        function closeTab(tabId) {
            var tabContent = document.getElementById(tabId);
            if (tabContent) {
                tabContent.parentNode.removeChild(tabContent); // Xóa nội dung tab
                var tabButton = document.querySelector("[data-tab='" + tabId + "']");
                if (tabButton) {
                    tabButton.parentNode.removeChild(tabButton); // Xóa tab button từ container
                }
                numberOfInvoices--; // Giảm số lượng tab đã tạo
            }
        }


        // Hàm để hiển thị thông báo Toast
        function showToast() {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });

            Toast.fire({
                icon: "error",
                title: "Bạn đã tạo tối đa 5 hóa đơn!"
            });
        }

        //thay đổi số lượng ở table
        function changeQuantity(event) {
            const input = event.target;
            let inputValue = input.value;

            // Loại bỏ tất cả các ký tự không phải số từ giá trị đầu vào
            inputValue = inputValue.replace(/\D/g, '');

            // Chuyển đổi giá trị thành số
            let numericValue = parseInt(inputValue);

            // Kiểm tra xem giá trị nhập vào có rỗng không
            if (inputValue === '') {
                input.value = '';
                return;
            }

            // Kiểm tra xem giá trị có nằm trong khoảng từ 1 đến 100 không
            if (numericValue < 1 || isNaN(numericValue)) {
                numericValue = 1;
            } else if (numericValue > 100) {
                numericValue = 100;
            }

            // Cập nhật giá trị của input
            input.value = numericValue;

            var element = document.getElementById(input.id + 'fsport');
            var newHref = " http://localhost:8080/ban-hang-tai-quay/update/" + input.id + "/" + input.value;
            element.setAttribute("href", newHref);
        }
    </script>
    <!-- thay đổi sản phẩm hdct -->
    <script>
        let thisNumberSPPage = 0;
        var reloadSP = document.getElementById('reloadsp');
        var btnSP = document.getElementById('changeSP');
        var nextPageSP = document.getElementById('nextPageSP');
        var prevPageSP = document.getElementById('prevPageSP');
        var tensp = document.getElementById('tensp');
        var chatlieu = document.getElementById('chatlieu');
        var thuonghieu = document.getElementById('thuonghieu');
        var degiay = document.getElementById('degiay');
        var kichco = document.getElementById('kichco');
        var mausac = document.getElementById('mausac');
        var gioitinh = document.getElementById('gioitinh');
        var khoanggia = document.getElementById('priceRange');

        function SearchSPHDCT() {
            var tentim = tensp.value;
            var cl = chatlieu.value;
            var th = thuonghieu.value;
            var dg = degiay.value;
            var kc = kichco.value;
            var ms = mausac.value;
            var gt = gioitinh.value;
            var kg = khoanggia.value;
            var list = [
                tentim, cl, th, dg, kc, ms, gt, kg
            ]
            var urltimSPCT = `/hoa-don/searchSP?lstData=${list}`;
            fetch(urltimSPCT)
                .then(function (c) {
                    return c.json();
                })
                .then(function (b) {

                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b) {
                        STT++;
                        htmlSP += `<tr>
                                   <td>${STT}</td>
                                   <td> 
                                    <img src="${hd.anh.tenanh}" alt=""
                                                                style="height: 100px; width: 100px;">
                                    
                                    </td>
                                   <td>${hd.sanpham.tensanpham}</td>
                                   <td>${hd.soluong}</td>
                                   <td>${hd.kichco.ten}</td>
                                   <td>${hd.mausac.ten}</td>
                                   <td>
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td>
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;
                    document.getElementById('navAddSPHDCT').style.display = 'none';

                })
        }




        tensp.onkeyup = function () {
            var tentim = tensp.value;
            var cl = chatlieu.value;
            var th = thuonghieu.value;
            var dg = degiay.value;
            var kc = kichco.value;
            var ms = mausac.value;
            var gt = gioitinh.value;
            var kg = khoanggia.value;
            var list = [
                tentim, cl, th, dg, kc, ms, gt, kg
            ]
            var urltimSPCT = `/hoa-don/searchSP?lstData=${list}`;
            fetch(urltimSPCT)
                .then(function (c) {
                    return c.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b) {
                        STT++;
                        htmlSP += `<tr>
                                   <td>${STT}</td>
                                   <td> 
                                    <img src="${hd.anh.tenanh}" alt=""
                                                                style="height: 100px; width: 100px;">
                                    
                                    </td>
                                   <td>${hd.sanpham.tensanpham}</td>
                                   <td>${hd.soluong}</td>
                                   <td>${hd.kichco.ten}</td>
                                   <td>${hd.mausac.ten}</td>
                                   <td>
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td>
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;
                    document.getElementById('navAddSPHDCT').style.display = 'none';

                })
        }







        reloadSP.onclick = function () {
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? 0;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;

            fetch(urlPage)
                .then(function (c) {
                    return c.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        STT++;
                        htmlSP += `<tr>
                                   <td>${STT}</td>
                                   <td> 
                                    <img src="${hd.anh.tenanh}" alt=""
                                                                style="height: 100px; width: 100px;">
                                    
                                    </td>
                                   <td>${hd.sanpham.tensanpham}</td>
                                   <td>${hd.soluong}</td>
                                   <td>${hd.kichco.ten}</td>
                                   <td>${hd.mausac.ten}</td>
                                   <td>
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td>
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById('navAddSPHDCT').style.display = 'block';
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }


        btnSP.onclick = function () {
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? 0;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;

            fetch(urlPage)
                .then(function (c) {
                    return c.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        STT++;
                        htmlSP += `<tr>
                                   <td>${STT}</td>
                                   <td> 
                                    <img src="${hd.anh.tenanh}" alt=""
                                                                style="height: 100px; width: 100px;">
                                    
                                    </td>
                                   <td>${hd.sanpham.tensanpham}</td>
                                   <td>${hd.soluong}</td>
                                   <td>${hd.kichco.ten}</td>
                                   <td>${hd.mausac.ten}</td>
                                   <td>
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td>
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }

        function pageClickSP(numbers) {
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? numbers;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;
            fetch(urlPage)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {

                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        STT++;
                        htmlSP += `<tr>
                                   <td>${STT}</td>
                                   <td> 
                                    <img src="${hd.anh.tenanh}" alt=""
                                                                style="height: 100px; width: 100px;">
                                    
                                    </td>
                                   <td>${hd.sanpham.tensanpham}</td>
                                   <td>${hd.soluong}</td>
                                   <td>${hd.kichco.ten}</td>
                                   <td>${hd.mausac.ten}</td>
                                   <td>
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td>
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }


        nextPageSP.onclick = function () {
            thisNumberSPPage++;
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? thisNumberSPPage;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;
            fetch(urlPage)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {

                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        STT++;
                        htmlSP += `<tr>
                                   <td>${STT}</td>
                                   <td> 
                                    <img src="${hd.anh.tenanh}" alt=""
                                                                style="height: 100px; width: 100px;">
                                    
                                    </td>
                                   <td>${hd.sanpham.tensanpham}</td>
                                   <td>${hd.soluong}</td>
                                   <td>${hd.kichco.ten}</td>
                                   <td>${hd.mausac.ten}</td>
                                   <td>
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td>
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }



        prevPageSP.onclick = function () {

            thisNumberSPPage--;
            const pageSPChanges = localStorage.getItem("pageSPChanges") ?? thisNumberSPPage;
            const urlPage = `/hoa-don/viewSPChanges?pageSPChanges=${pageSPChanges}`;
            fetch(urlPage)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {

                    var STT = 0;
                    let htmlSP = '';
                    let htmlNumberPageSP = '';
                    for (const hd of b.content) {
                        STT++;
                        htmlSP += `<tr>
                                   <td>${STT}</td>
                                   <td> 
                                    <img src="${hd.anh.tenanh}" alt=""
                                                                style="height: 100px; width: 100px;">
                                    
                                    </td>
                                   <td>${hd.sanpham.tensanpham}</td>
                                   <td>${hd.soluong}</td>
                                   <td>${hd.kichco.ten}</td>
                                   <td>${hd.mausac.ten}</td>
                                   <td>
                                    <p  style="font-family: 'Times New Roman'; font-size: 15px; border-radius: 14px; background-color: green; padding: 3px 15px 3px 15px; color: white;">
                                        ${hd.trangthai == true ? 'Đang kinh doanh' : 'Ngừng kinh doanh'}
                                        </p>
                                    </td>
                                   <td>
                                    <a href="http://localhost:8080/ban-hang-tai-quay/ChoseSP/${hd.id}"><button
                                    class="btn btn-warning">
                                    chọn
                                     </button></a>
                                     </td>
                                </tr>`;
                    }

                    if (thisNumberSPPage < 1) {
                        prevPageSP.style.display = 'none';
                    } else {
                        prevPageSP.style.display = 'block';
                    }
                    if (thisNumberSPPage >= b.totalPages - 1) {
                        nextPageSP.style.display = 'none';
                    } else {
                        nextPageSP.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPageSP += `
                            <a class="page-link" onclick="pageClickSP( ${i - 1})">
                                                                                        ${i}
                             </a>
                            `;
                    }
                    document.getElementById("numberPageSP").innerHTML = htmlNumberPageSP;
                    document.getElementById("tbl_sp_them").innerHTML = htmlSP;

                })
        }

    </script>

    <script>
        // Lấy phần tử thanh trượt và phần tử hiển thị giá trị
        var priceRange = document.getElementById("priceRange");
        var priceRangeValue = document.getElementById("priceRangeValue");

        // Lắng nghe sự kiện khi người dùng thay đổi giá trị thanh trượt
        priceRange.oninput = function () {
            // Cập nhật giá trị hiển thị
            var show = this.value
                .replace(/\D/g, "")
                .replace(/([0-9])([0-9]{})$/, '$1.$2')
                .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ",");
            priceRangeValue.innerText = show + ' đ';
        };
    </script>



    <!-- thay đổi khách hàng -->
    <script>
        let thisNumberPage = 0;

        var reload = document.getElementById('reloadnv');
        var btn = document.getElementById('changeNV');
        var nextPage = document.getElementById('nextPage');
        var prevPage = document.getElementById('prevPage');
        var navNV = document.getElementById('navNV');

        reload.onclick = function () {
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? 0;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';
                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }

                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById('navNV').style.display = 'block';
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }




        btn.onclick = function () {
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? 0;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';
                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }

                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById('navNV').style.display = 'block';
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }

        var searchNV = document.getElementById('searchNV');

        searchNV.onkeyup = function () {
            var keySearch = searchNV.value;
            var url = `/ban-hang-tai-quay/searchNV?keySearch=${keySearch}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    for (const hd of b) {
                        STT++;
                        html += `<tr>
                       <td>${STT}</td>
                       <td>${hd.makhachhang}</td>
                       <td>${hd.nguoidung.hovaten}</td>
                       <td>${hd.nguoidung.sodienthoai}</td>
                       <td>${hd.nguoidung.ngaysinh}</td>
                       <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                       <td>
                        <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                        class="btn btn-warning">
                        chọn
                         </button></a>
                         </td>
                    </tr>`;
                    }
                    document.getElementById('navNV').style.display = 'none';
                    document.getElementById("tbl_doi_nv").innerHTML = html;
                })
        }


        function pageClick(number) {
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? number;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';
                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }
                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }

        nextPage.onclick = function () {
            thisNumberPage++;
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? thisNumberPage;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';
                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }
                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }



        prevPage.onclick = function () {

            thisNumberPage--;
            const pageNVChanges = localStorage.getItem("pageNVChanges") ?? thisNumberPage;
            const url = `/ban-hang-tai-quay/viewNVChanges?pageNVChanges=${pageNVChanges}`;
            fetch(url)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var STT = 0;
                    let html = '';
                    let htmlNumberPage = '';

                    for (const hd of b.content) {
                        STT++;
                        html += `<tr>
                               <td>${STT}</td>
                               <td>${hd.makhachhang}</td>
                               <td>${hd.nguoidung.hovaten}</td>
                               <td>${hd.nguoidung.sodienthoai}</td>
                               <td>${hd.nguoidung.ngaysinh}</td>
                               <td>${hd.nguoidung.gioitinh == true ? 'Nam' : 'Nữ'}</td>
                               <td>
                                <a href="http://localhost:8080/ban-hang-tai-quay/ChoseKH/${hd.id}"><button
                                class="btn btn-warning">
                                chọn
                                 </button></a>
                                 </td>
                            </tr>`;
                    }
                    if (thisNumberPage < 1) {
                        prevPage.style.display = 'none';
                    } else {
                        prevPage.style.display = 'block';
                    }
                    if (thisNumberPage >= b.totalPages - 1) {
                        nextPage.style.display = 'none';
                    } else {
                        nextPage.style.display = 'block';
                    }
                    for (var i = 1; i <= b.totalPages; i++) {
                        htmlNumberPage += `
                        <a class="page-link" onclick="pageClick( ${i - 1})">
                                                                                    ${i}
                         </a>
                        `;
                    }
                    document.getElementById("numberPage").innerHTML = htmlNumberPage;
                    document.getElementById("tbl_doi_nv").innerHTML = html;

                })
        }
        //hiển thị nút trả sau trước
        function giaohang(event) {
            var isChecked = event.target.checked;
            if (isChecked) {
                // hiển thị div 
                document.getElementById('diachidiv').style.display = 'block';
                showdiachimacdinh();
            } else {
                // ẩn div
                document.getElementById('diachidiv').style.display = 'none';

            }
        }


        // function giaohang() {
        //     var htmltrasau = '';
        //     var htmldiachi = '';
        //     var htmlPhiVanChuyen = '';

        //     htmlPhiVanChuyen = ` <p style="font-weight: bold">Phí vận chuyển:</p>
        //                     <p>
        //                         <input type="text" style="width: 180px;height: 30px" class="form-control" oninput="showcasst('phigiaohang')" id="phigiaohang">
        //                     </p>`;

        //     htmltrasau = `  <p style="font-weight: bold">Trả sau:</p>
        //                     <p class="form-check form-switch">
        //                         <input class="form-check-input" type="checkbox" role="switch" id="trasau">
        //                     </p>`;
        //     htmldiachi = `  <form th:object="${thongtingiaohang}">
        //                           <p>
        //                     <input type="text" class="form-control" placeholder="Nhập họ và tên" th:field="*{ten}">
        //                 </p>
        //                 <p>
        //                     <input type="text" class="form-control" placeholder="Nhập số điện thoại" th:field="*{sdt}">
        //                 </p>
        //                 <p>
        //                     <input type="text" class="form-control" placeholder="Nhập email" th:field="*{email}">
        //                 </p>
        //                 <p>
        //                     <input type="text" class="form-control" placeholder="Nhập địa chỉ" th:field="*{diachi}">
        //                 </p>
        //                 <p class="d-flex">
        //                     <select class="form-select form-select-sm mb-3" id="city" th:field="*{tinh}">
        //                                 <option value="" th:text="*{tinh}" selected>
        //                                     Chọn tỉnh thành</option>
        //                             </select>
        //                             <select class="form-select form-select-sm mb-3" id="district" th:field="*{huyen}">
        //                                 <option value="" th:text="*{huyen}" selected>Chọn quận huyện</option>
        //                             </select>
        //                             <select class="form-select form-select-sm mb-3" id="ward" th:field="*{xa}">
        //                                 <option value="" th:text="*{xa}" selected>
        //                                     Chọn phường xã</option>
        //                             </select>
        //                 </p>
        //                 <p>
        //                     <textarea class="form-control" placeholder="Ghi chú" th:field="*{ghichu}"></textarea>
        //                 </p> 
        //             </form>
        //                 `;
        //     var checkBox = document.getElementById('checktrasau');
        //     if (checkBox.checked) {
        //         document.getElementById('trasauhtml').innerHTML = htmltrasau;
        //         document.getElementById('diachihtml').innerHTML = htmldiachi;
        //         document.getElementById('phiShip').innerHTML = htmlPhiVanChuyen;
        //     } else {
        //         document.getElementById('trasauhtml').innerHTML = '';
        //         document.getElementById('diachihtml').innerHTML = '';
        //         document.getElementById('phiShip').innerHTML = '';
        //     }

        // }

        function seton() {
            var check = document.getElementById('inputThemNhanh');
            var show = document.getElementById('showndcheck');
            var htmlshowon = '';
            if (check.checked) {
                htmlshowon = ` <p style="font-style: italic;">Thêm nhanh và lựa chọn khách hàng cho hóa đơn!</p>`;
                show.innerHTML = htmlshowon;
            }

            else {
                htmlshowon = ` <p style="text-decoration: line-through; font-style: italic;">Thêm nhanh và lựa chọn khách hàng cho hóa đơn!</p>`;
                show.innerHTML = htmlshowon;
            }
        }
    </script>


    <!-- call api địa chỉ cho thêm địa chỉ giao hàng -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        var citiesSelect = document.getElementById("tinhthanh");
        var districtsSelect = document.getElementById("quanhuyen");
        var wardsSelect = document.getElementById("xaphuong");
        var ajaxParameters = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };
        var ajaxPromise = axios(ajaxParameters);
        ajaxPromise.then(function (response) {
            populateCities(response.data);
        });

        function populateCities(data) {
            for (const city of data) {
                var optionElement = document.createElement('option');
                optionElement.value = city.Name;
                optionElement.text = city.Name;
                optionElement.setAttribute('data-id', city.Id);
                citiesSelect.options.add(optionElement);
            }
            citiesSelect.onchange = function () {
                districtsSelect.length = 1;
                wardsSelect.length = 1;
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const selectedCity = data.filter(city => city.Id === this.options[this.selectedIndex].dataset.id);

                    for (const district of selectedCity[0].Districts) {
                        var optionElement = document.createElement('option');
                        optionElement.value = district.Name;
                        optionElement.text = district.Name;
                        optionElement.setAttribute('data-id', district.Id);
                        districtsSelect.options.add(optionElement);
                    }
                }
            };
            districtsSelect.onchange = function () {
                wardsSelect.length = 1;
                const selectedCityData = data.filter(city => city.Id === citiesSelect.options[citiesSelect.selectedIndex].dataset.id);
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const selectedDistrictWards = selectedCityData[0].Districts.filter(district => district.Id === this.options[this.selectedIndex].dataset.id)[0].Wards;

                    for (const ward of selectedDistrictWards) {
                        var optionElement = document.createElement('option');
                        optionElement.value = ward.Name;
                        optionElement.text = ward.Name;
                        optionElement.setAttribute('data-id', ward.Id);
                        wardsSelect.options.add(optionElement);
                    }
                }
            };
        }
    </script>
    <!-- <script>
        var thanhpho = document.getElementById("tinhthanh");
        var huyen = document.getElementById("quanhuyen");
        var phuong = document.getElementById("xaphuong");
        var para = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };
        var pro = axios(para);
        pro.then(function (result) {
            renCity(result.data);
        });

        function renCity(data) {
            for (const x of data) {
                var opt = document.createElement('option');
                opt.value = x.Name;
                opt.text = x.Name;
                opt.setAttribute('data-id', x.Id);
                thanhpho.options.add(opt);
            }
            thanhpho.onchange = function () {
                huyen.length = 1;
                ward.length = 1;
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const result = data.filter(n => n.Id === this.options[this.selectedIndex].dataset.id);

                    for (const k of result[0].huyen) {
                        var opt = document.createElement('option');
                        opt.value = k.Name;
                        opt.text = k.Name;
                        opt.setAttribute('data-id', k.Id);
                        huyen.options.add(opt);
                    }
                }
            };
            huyen.onchange = function () {
                alert("distric")
                ward.length = 1;
                const dataCity = data.filter((n) => n.Id === thanhpho.options[thanhpho.selectedIndex].dataset.id);
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const dataWards = dataCity[0].huyen.filter(n => n.Id === this.options[this.selectedIndex].dataset.id)[0].phuong;

                    for (const w of dataWards) {
                        var opt = document.createElement('option');
                        opt.value = w.Name;
                        opt.text = w.Name;
                        opt.setAttribute('data-id', w.Id);
                        phuong.options.add(opt);
                    }
                }
            };
        }
    </script> -->


    <!--call địa chỉ cho thêm nhanh khách hàng-->
    <script>
        var citis = document.getElementById("city");
        var districts = document.getElementById("district");
        var wards = document.getElementById("ward");
        var Parameter = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };
        var promise = axios(Parameter);
        promise.then(function (result) {
            renderCity(result.data);
        });

        function renderCity(data) {
            for (const x of data) {
                var opt = document.createElement('option');
                opt.value = x.Name;
                opt.text = x.Name;
                opt.setAttribute('data-id', x.Id);
                citis.options.add(opt);
            }
            citis.onchange = function () {
                district.length = 1;
                ward.length = 1;
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const result = data.filter(n => n.Id === this.options[this.selectedIndex].dataset.id);

                    for (const k of result[0].Districts) {
                        var opt = document.createElement('option');
                        opt.value = k.Name;
                        opt.text = k.Name;
                        opt.setAttribute('data-id', k.Id);
                        district.options.add(opt);
                    }
                }
            };
            district.onchange = function () {
                ward.length = 1;
                const dataCity = data.filter((n) => n.Id === citis.options[citis.selectedIndex].dataset.id);
                if (this.options[this.selectedIndex].dataset.id != "") {
                    const dataWards = dataCity[0].Districts.filter(n => n.Id === this.options[this.selectedIndex].dataset.id)[0].Wards;

                    for (const w of dataWards) {
                        var opt = document.createElement('option');
                        opt.value = w.Name;
                        opt.text = w.Name;
                        opt.setAttribute('data-id', w.Id);
                        wards.options.add(opt);
                    }
                }
            };
        }



        // thanh toán modal hóa đơn
        function thanhtoan() {
            const urlthanhtoan = `http://localhost:8080/ban-hang-tai-quay/thanh-toan`;
            fetch(urlthanhtoan)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    var htmlpt = '';
                    console.log(b)
                    if (b.length > 0) {
                        var stt = 0;
                        var tiendathanhtoan = 0;
                        var checktienmat = 0;
                        var checkchuyenkhoan = 0;
                        for (const hd of b) {
                            if (hd.mota == 'tiền mặt') {
                                checktienmat = 1;

                            }
                            if (hd.mota == 'chuyển khoản') {
                                checkchuyenkhoan = 1;
                            }
                            tiendathanhtoan += hd.tongtien;
                            stt++;
                            htmlpt += ` <tr>
                                              <td>${stt}</td>
                                              <td>${hd.magiaodichvnpay == null ? '' : hd.magiaodichvnpay}</td>
                                              <td>${hd.tongtien}</td>
                                              <td>${hd.mota}</td>
                                              <td>
                                                <a onclick="xoaphuongthuc('http://localhost:8080/ban-hang-tai-quay/delete-pttt/${hd.tongtien}')"
                                                            >
                                                            <button class="btn btn-outline-danger"
                                                                
                                                                type="button"><i class="bi bi-trash3"></i></button></a>
                                              </td>
                                          </tr>`;
                        }
                        if (checkchuyenkhoan == 1) {
                            document.getElementById('chuyenkhoan').disabled = true;
                        }
                        if (checktienmat == 1) {
                            document.getElementById('tienmat').disabled = true;
                        }
                        document.getElementById('dathanhtoanroi').innerHTML = tiendathanhtoan;
                        document.getElementById('showpt').innerHTML = htmlpt;
                        var showTien = document.getElementById('sotienhienthi');
                        showTien.value = (tienkhachthanhtoan - tiendathanhtoan).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                        document.getElementById('tienthieu').innerHTML = (tienkhachthanhtoan - tiendathanhtoan).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                        document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                        if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                            document.getElementById('xacnhanPT').disabled = false;
                        } else {
                            document.getElementById('xacnhanPT').disabled = true;
                        }


                    } else {

                        var showTien = document.getElementById('sotienhienthi');
                        document.getElementById('showpt').innerHTML = htmlpt;
                        showTien.value = tienkhachthanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                        document.getElementById('tienthieu').innerHTML = tienkhachthanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                        document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                        document.getElementById('dathanhtoanroi').innerHTML = '0đ';
                        if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                            document.getElementById('xacnhanPT').disabled = false;
                        } else {
                            document.getElementById('xacnhanPT').disabled = true;
                        }

                    }

                })
        }
        // Xóa ký hiệu "₫" và các dấu phân cách khỏi tiền 
        function convertCurrency(formattedAmount) {
            // Xóa ký hiệu "₫" và các dấu phân cách
            let numericAmount = formattedAmount.replace(/[^0-9]/g, '');
            return numericAmount;
        }
        // định dạng show tiền tệ dựa trên onclick
        function showcasst(elementId) {
            $('#' + elementId).keyup(function (event) {
                $(this).val(function (index, value) {
                    return value
                        .replace(/\D/g, "")
                        .replace(/([0-9])([0-9]{})$/, '$1.$2')
                        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".")
                        + ' ₫';
                });
            });
        }

        function xacnhanphuongthuc(inputv) {
            const kieuTT = [inputv, document.getElementById('sotienhienthi').value];
            const urlthanhtoan = `http://localhost:8080/ban-hang-tai-quay/xac-nhan-phuong-thuc?phuongthuc=${kieuTT}`;
            fetch(urlthanhtoan)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {

                    var htmlphuongthuc = '';
                    if (b.length > 0) {
                        //xác nhận phương thức
                        var stt = 0;
                        var tiendathanhtoan = 0;
                        var checktienmat = 0;
                        var checkchuyenkhoan = 0;
                        for (const hd of b) {
                            if (hd.mota == 'tiền mặt') {
                                checktienmat = 1;

                            }
                            if (hd.mota == 'chuyển khoản') {
                                checkchuyenkhoan = 1;
                            }
                            tiendathanhtoan += hd.tongtien;
                            stt++;
                            htmlphuongthuc += ` <tr>
                                            <td>${stt}</td>
                                            <td>${hd.magiaodichvnpay == null ? '' : hd.magiaodichvnpay}</td>
                                            <td>${hd.tongtien.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}</td>
                                            <td>${hd.mota}</td>
                                            <td>
                                                <a onclick="xoaphuongthuc('http://localhost:8080/ban-hang-tai-quay/delete-pttt/${hd.tongtien}')"  
                                                            >
                                                            <button class="btn btn-outline-danger"
                                                               
                                                                type="button"><i class="bi bi-trash3"></i></button></a>
                                            </td>
                                        </tr>`;
                        }

                        if (convertCurrency(document.getElementById('sotienhienthi').value) > 0) {
                            if (checkchuyenkhoan == 1) {
                                document.getElementById('chuyenkhoan').disabled = true;
                            }
                            if (checktienmat == 1) {
                                document.getElementById('tienmat').disabled = true;
                            }
                            var tienthieuconlai = tienkhachthanhtoan - tiendathanhtoan;

                            document.getElementById('showpt').innerHTML = htmlphuongthuc;
                            document.getElementById('dathanhtoanroi').innerHTML = tiendathanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });;
                            var showTien = document.getElementById('sotienhienthi');
                            showTien.value = tienthieuconlai.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tienthieu').innerHTML = tienthieuconlai.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                            if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                                document.getElementById('xacnhanPT').disabled = false;
                            } else {
                                document.getElementById('xacnhanPT').disabled = true;
                            }

                        }

                    } else {

                    }

                })
        }
        function xacnhanthanhcongcf() {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });

            Toast.fire({
                icon: "success",
                title: "Xác nhận thanh toán thành công!"
            });
        }
        //xác nhận phương thức thanh toán
        function xacnhanPTTT() {
            document.getElementById('xacnhanthanhtoanhoadon').disabled = false;
            document.getElementById('changeNV').disabled = true;
            document.getElementById('changeSP').disabled = true;
            xacnhanthanhcongcf();
            // disabled hết các nút sau khi xác nhận

        }
        //xóa bản ghi phương thức thanh toán
        function xoaphuongthuc(url) {
            if (confirm('Bạn muốn loại bỏ bản giao dịch này?')) {
                fetch(url)
                    .then(function (a) {
                        return a.json();
                    })
                    .then(function (b) {
                        var htmlpt = '';
                        var checkchuyenkhoan = 0;
                        var checktienmat = 0;
                        if (b.length > 0) {
                            var stt = 0;
                            var tiendathanhtoan = 0;
                            for (const hd of b) {
                                if (hd.mota == 'tiền mặt') {
                                    checktienmat = 1;
                                }
                                if (hd.mota == 'chuyển khoản') {
                                    checkchuyenkhoan = 1;
                                }
                                tiendathanhtoan += hd.tongtien;
                                stt++;
                                htmlpt += ` <tr>
                                              <td>${stt}</td>
                                              <td>${hd.magiaodichvnpay == null ? '' : hd.magiaodichvnpay}</td>
                                              <td>${hd.tongtien}</td>
                                              <td>${hd.mota}</td>
                                              <td>
                                                <a onclick="xoaphuongthuc('http://localhost:8080/ban-hang-tai-quay/delete-pttt/${hd.tongtien}')"
                                                            >
                                                            <button class="btn btn-outline-danger"
                                                                
                                                                type="button"><i class="bi bi-trash3"></i></button></a>
                                              </td>
                                          </tr>`;
                            }
                            if (checkchuyenkhoan == 1) {
                                document.getElementById('chuyenkhoan').disabled = true;
                            } else {
                                document.getElementById('chuyenkhoan').disabled = false;
                            }
                            if (checktienmat == 1) {
                                document.getElementById('tienmat').disabled = true;
                            } else {
                                document.getElementById('tienmat').disabled = false;
                            }

                            document.getElementById('dathanhtoanroi').innerHTML = tiendathanhtoan;
                            document.getElementById('showpt').innerHTML = htmlpt;
                            var showTien = document.getElementById('sotienhienthi');
                            showTien.value = (tienkhachthanhtoan - tiendathanhtoan).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tienthieu').innerHTML = (tienkhachthanhtoan - tiendathanhtoan).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                            if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                                document.getElementById('xacnhanPT').disabled = false;
                            } else {
                                document.getElementById('xacnhanPT').disabled = true;
                            }

                        } else {

                            document.getElementById('chuyenkhoan').disabled = false;
                            document.getElementById('tienmat').disabled = false;
                            document.getElementById('showpt').innerHTML = htmlpt;
                            var showTien = document.getElementById('sotienhienthi');
                            showTien.value = tienkhachthanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('tienthieu').innerHTML = tienkhachthanhtoan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                            document.getElementById('hdThanhToanShow').innerHTML = hdHienTai;
                            document.getElementById('dathanhtoanroi').innerHTML = '0đ';
                            if (convertCurrency(document.getElementById('sotienhienthi').value) == 0) {
                                document.getElementById('xacnhanPT').disabled = false;
                            } else {
                                document.getElementById('xacnhanPT').disabled = true;
                            }
                        }

                    })
            }
        }

        //thông báo dùng chung
        //         "success": Biểu tượng thành công (dấu kiểm xanh).
        // "error": Biểu tượng lỗi (dấu chéo đỏ).
        // "warning": Biểu tượng cảnh báo (dấu chấm than vàng).
        // "info": Biểu tượng thông tin (chữ 'i' trong vòng tròn xanh).
        // "question": Biểu tượng câu hỏi (dấu chấm hỏi trong vòng tròn xanh).
        function thongbao(title, iconsz) {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });

            Toast.fire({
                icon: iconsz,
                title: title
            });
        }
        //chặn đường dẫn thẻ a
        function handleLinkClick() {

            document.getElementById('changeNV').disabled = false;
            document.getElementById('changeSP').disabled = false;
            var checkgiaohang = document.getElementById('checktrasau');
            var actionGiao = document.getElementById('thongtingiaohangform');
            if (checkgiaohang.checked) {
                //giao hàng submit
                actionGiao.action = 'http://localhost:8080/ban-hang-tai-quay/xacnhanthanhtoan/2';
                actionGiao.submit();
                thongbao('Đặt đơn thành công', 'success');
            } else {
                //giao hàng submit
                actionGiao.action = 'http://localhost:8080/ban-hang-tai-quay/xacnhanthanhtoan/1';
                actionGiao.submit();
                thongbao('Đặt đơn thành công', 'success');
            }
            // thongbao('Chưa xác nhận thông tin thanh toán!!!', 'warning');

        }
        //xác định nghiệp vụ trả sau trả trước
        function handleCheckboxChange(event) {
            // Lấy phần tử checkbox từ sự kiện

            var checkbox = event.target;

            // Kiểm tra trạng thái của checkbox
            if (checkbox.checked) {
                //hóa đơn lựa chọn trả sau_mở nút xác nhận thanh toán và không cần thanh toán trước
                document.getElementById('xacnhanthanhtoanhoadon').disabled = false;
                document.getElementById('chantrasau').disabled = true;

            } else {
                //hóa đơn lựa chọn trả trước đóng nút xác nhận thanh toán và yêu cầu thanh toán trước
                document.getElementById('xacnhanthanhtoanhoadon').disabled = true;
                document.getElementById('chantrasau').disabled = false;
            }
        }

        //http://localhost:8080/ban-hang-tai-quay/fillDiachi
        function showdiachimacdinh() {
            const urldcgiao = `http://localhost:8080/ban-hang-tai-quay/fillDiachi`;
            fetch(urldcgiao)
                .then(function (a) {
                    return a.json();
                })
                .then(function (b) {
                    document.getElementById('thongtingiao_ten').value = b.ten;
                    document.getElementById('thongtingiao_sdt').value = b.sdt;
                    document.getElementById('thongtingiao_email').value = b.email;
                    document.getElementById('thongtingiao_diachi').value = b.diachi;
                    document.getElementById('tinhthanh').value = b.tinh;

                    document.getElementById('quanhuyen').innerHTML = '';
                    var optionhuyen = document.createElement('option');
                    optionhuyen.value = b.huyen;
                    optionhuyen.textContent = b.huyen;
                    document.getElementById('quanhuyen').appendChild(optionhuyen);


                    document.getElementById('xaphuong').innerHTML = '';
                    var optionxa = document.createElement('option');
                    optionxa.value = b.xa;
                    optionxa.textContent = b.xa;
                    document.getElementById('xaphuong').appendChild(optionxa);


                    if (b.xa == null) {
                        var optionxaa = document.createElement('option');
                        optionxaa.value = 'chọn xã';
                        optionxaa.textContent = 'chọn xã';
                        optionxaa.selected = true;
                        document.getElementById('xaphuong').appendChild(optionxaa);
                    }
                    if (b.huyen == null) {
                        var optionhuyena = document.createElement('option');
                        optionhuyena.value = 'chọn huyện';
                        optionhuyena.textContent = 'chọn huyện';
                        optionhuyena.selected = true;
                        document.getElementById('quanhuyen').appendChild(optionhuyena);
                    }
                    if (b.tinh == null) {
                        document.getElementById('tinhthanh').value = 'chọn tỉnh';
                    }
                })
        }

    </script>
</body>

</html>